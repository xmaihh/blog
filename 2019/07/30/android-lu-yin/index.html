<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Androidå½•éŸ³ | å°éº¦</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/blog/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/blog/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=G-R3NLYDC8PK" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-R3NLYDC8PK');
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "n85h4t74i7");
</script><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Androidå½•éŸ³</h1><a id="logo" href="/blog/.">å°éº¦</a><p class="description">äººç”Ÿçš„å¤§èµ·å¤§è½æ¥å¾—å¤ªçªç„¶ï¼Œæå¾—æˆ‘ç›´æƒ³å°¿å°¿...</p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/blog/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/blog/history/"><i class="fa fa-book"> å†å²</i></a><a href="/blog/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/blog/guestbook/"><i class="fa fa-comments"> ç•™è¨€</i></a><a href="/blog/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Androidå½•éŸ³</h1><div class="post-meta">2019-07-30<span> | </span><span class="category"><a href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 6.2k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 31</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><a class="disqus-comment-count" href="/blog/2019/07/30/android-lu-yin/#vcomment"><span class="valine-comment-count" data-xid="/blog/2019/07/30/android-lu-yin/"></span><span> æ¡è¯„è®º</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-Android-%E4%B8%AD%E5%BD%95%E9%9F%B3%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.</span> <span class="toc-text">ä»‹ç» Android ä¸­å½•éŸ³åŠŸèƒ½çš„å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%95%E9%9F%B3%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">å½•éŸ³æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">éŸ³é¢‘å‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">ç¼–ç æ ¼å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MediaRecorder"><span class="toc-number">1.4.</span> <span class="toc-text">MediaRecorder</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AudioRecord"><span class="toc-number">1.5.</span> <span class="toc-text">AudioRecord</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%B9%E5%BD%95%E8%BE%B9%E6%92%AD%EF%BC%88AudioRecord-AudioTrack%EF%BC%89"><span class="toc-number">1.6.</span> <span class="toc-text">è¾¹å½•è¾¹æ’­ï¼ˆAudioRecord + AudioTrackï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%95%E5%88%B6mp3%E6%A0%BC%E5%BC%8F%E9%9F%B3%E9%A2%91"><span class="toc-number">1.7.</span> <span class="toc-text">å½•åˆ¶mp3æ ¼å¼éŸ³é¢‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDlame%E5%BA%93"><span class="toc-number">1.7.1.</span> <span class="toc-text">ä¸‹è½½lameåº“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%AF%BC%E5%85%A5"><span class="toc-number">1.7.2.</span> <span class="toc-text">æºç å¯¼å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">1.7.3.</span> <span class="toc-text">ä¿®æ”¹åº“æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99CmakeList-txt"><span class="toc-number">1.7.4.</span> <span class="toc-text">ç¼–å†™CmakeList.txt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99-java-%E7%B1%BB%E5%92%8C-c-%E6%96%87%E4%BB%B6"><span class="toc-number">1.7.5.</span> <span class="toc-text">ç¼–å†™ java ç±»å’Œ c æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEbuild-gradle"><span class="toc-number">1.7.6.</span> <span class="toc-text">é…ç½®build.gradle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%95%E5%88%B6MP3%E6%A0%BC%E5%BC%8F%E9%9F%B3%E9%A2%91"><span class="toc-number">1.7.7.</span> <span class="toc-text">å½•åˆ¶MP3æ ¼å¼éŸ³é¢‘</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E8%A7%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">éŸ³é¢‘è§£ç </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BD%95%E9%9F%B3%E6%B7%BB%E5%8A%A0%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90%E5%B9%B6%E5%AE%9E%E6%97%B6%E6%92%AD%E6%94%BE%EF%BC%8C%E7%B1%BB%E4%BC%BCK%E6%AD%8C%E6%95%88%E6%9E%9C"><span class="toc-number">3.</span> <span class="toc-text">å½•éŸ³æ·»åŠ èƒŒæ™¯éŸ³ä¹å¹¶å®æ—¶æ’­æ”¾ï¼Œç±»ä¼¼Kæ­Œæ•ˆæœ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="post-content"><h1 id="ä»‹ç»-Android-ä¸­å½•éŸ³åŠŸèƒ½çš„å®ç°"><a href="#ä»‹ç»-Android-ä¸­å½•éŸ³åŠŸèƒ½çš„å®ç°" class="headerlink" title="ä»‹ç» Android ä¸­å½•éŸ³åŠŸèƒ½çš„å®ç°"></a>ä»‹ç» Android ä¸­å½•éŸ³åŠŸèƒ½çš„å®ç°</h1><h2 id="å½•éŸ³æ–¹æ³•"><a href="#å½•éŸ³æ–¹æ³•" class="headerlink" title="å½•éŸ³æ–¹æ³•"></a>å½•éŸ³æ–¹æ³•</h2><p>Android ä¸­çš„å½•éŸ³ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ MediaRecorder å’Œ AudioRecord</p>
<ul>
<li><p>MediaRecorderï¼ˆåŸºäºæ–‡ä»¶ï¼‰</p>
<p>  å¯ä»¥å½•åˆ¶éŸ³ã€è§†é¢‘ï¼›</p>
<p>  å°è£…äº†å½•åˆ¶ã€ç¼–ç ã€å‹ç¼©ã€çº¿ç¨‹ç­‰åŠŸèƒ½ï¼Œç›´æ¥ç”Ÿæˆå¯æ’­æ”¾çš„éŸ³é¢‘æ–‡ä»¶ï¼›</p>
<p>  ä¼˜ç‚¹ï¼šå°è£…åº¦é«˜ï¼Œæ“ä½œç®€å•</p>
<p>  ç¼ºç‚¹ï¼šç¼–ç æ ¼å¼æœ‰é™ï¼Œ.aac  .amr  .3gpï¼Œä½†æ˜¯æ²¡æœ‰ mp3ã€wav æ ¼å¼</p>
</li>
<li><p>AudioRecordï¼ˆåŸºäºå­—èŠ‚æµï¼‰</p>
<p>  â€‹    åªèƒ½å½•åˆ¶éŸ³é¢‘ï¼›</p>
<p>  â€‹    è¾“å‡ºçš„æ˜¯ PCM çš„å£°éŸ³æ•°æ®ï¼Œå¦‚æœä¿å­˜æˆæ–‡ä»¶æ˜¯ä¸èƒ½ç›´æ¥æ’­æ”¾çš„ï¼Œéœ€è¦ç¼–ç ï¼›</p>
<p>  â€‹    å¯ä»¥æ•è·éŸ³é¢‘æµï¼Œè¾¹å½•åˆ¶è¾¹å¤„ç†ï¼Œæ¯”å¦‚ç¼–ç ã€å˜å£°ã€æ·»åŠ èƒŒæ™¯éŸ³ä¹ã€‚</p>
<p>  â€‹    ä¼˜ç‚¹ï¼šæ›´çµæ´»</p>
<p>  â€‹    ç¼ºç‚¹ï¼šéœ€è‡ªè¡Œå¤„ç†ç¼–ç ã€å¼€çº¿ç¨‹ç­‰å·¥ä½œ</p>
<p>  â€‹    åº”ç”¨åœºæ™¯ï¼šè¯­éŸ³èŠå¤©ã€æ±¤å§†çŒ«ã€Kæ­Œâ€¦</p>
</li>
</ul>
<blockquote>
<p>PCMï¼šPulse Code Modulationï¼ˆè„‰å†²ç¼–ç è°ƒåˆ¶ï¼‰ï¼Œæ˜¯å¯¹è¿ç»­å˜åŒ–çš„æ¨¡æ‹Ÿä¿¡å·è¿›è¡ŒæŠ½æ ·ã€é‡åŒ–å’Œç¼–ç äº§ç”Ÿçš„æ•°å­—ä¿¡å·ã€‚<br>å®ƒä¸æ˜¯ä¸€ç§éŸ³é¢‘æ ¼å¼ï¼Œå®ƒæ˜¯å£°éŸ³æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œä¹Ÿå°±æ˜¯å£°éŸ³çš„å†…å®¹ï¼Œæ²¡æœ‰æ–‡ä»¶å¤´ã€‚ç»è¿‡æŸç§æ ¼å¼çš„å‹ç¼©ã€ç¼–ç ç®—æ³•å¤„ç†ä»¥åï¼Œå†åŠ ä¸Šè¿™ç§æ ¼å¼çš„æ–‡ä»¶å¤´ï¼Œæ‰æ˜¯è¿™ç§æ ¼å¼çš„éŸ³é¢‘æ–‡ä»¶ã€‚</p>
</blockquote>
<h2 id="éŸ³é¢‘å‚æ•°"><a href="#éŸ³é¢‘å‚æ•°" class="headerlink" title="éŸ³é¢‘å‚æ•°"></a>éŸ³é¢‘å‚æ•°</h2><ul>
<li>é‡‡æ ·é¢‘ç‡ï¼š</li>
</ul>
<p>â€‹       è‡ªç„¶ç•Œçš„å£°éŸ³è½¬æ¢æˆæ•°å­—æ ¼å¼æ—¶ï¼Œè¦å¯¹å®ƒè¿›è¡Œé‡‡æ ·ï¼Œæ¯ç§’é’Ÿé‡‡æ ·çš„æ¬¡æ•°å°±æ˜¯é‡‡æ ·ç‡ã€‚å°±å¥½æ¯”ç”µå½±çš„1ç§’24å¸§ç”»é¢ã€‚æœ€å¸¸ç”¨ï¼š44.1kHzã€‚</p>
<ul>
<li>é‡‡æ ·ä½æ•°ï¼š</li>
</ul>
<p>â€‹       ä¸€ä¸ªé‡‡æ ·æ ·æœ¬ç”¨å¤šå°‘ä½äºŒè¿›åˆ¶æ•°ç¼–ç ï¼Œæœ€å¸¸ç”¨ï¼š16ä½ã€‚</p>
<ul>
<li>å£°é“æ•°ï¼š</li>
</ul>
<p>â€‹       åˆ†ä¸ºå•å£°é“å’ŒåŒå£°é“ï¼ŒåŒå£°é“åˆå«ç«‹ä½“å£°ï¼ŒåŒå£°é“éŸ³é¢‘æ–‡ä»¶æ¯”å•å£°é“å¤§ä¸€å€ã€‚</p>
<ul>
<li>æ¯”ç‰¹ç‡ï¼ˆç ç‡ï¼‰ï¼š</li>
</ul>
<p>â€‹       æ¯ç§’é’ŸéŸ³é¢‘æ–‡ä»¶æ‰€å çš„ bit æ•°ã€‚å•ä½ ï¼škbpsï¼ˆæ¯ç§’åƒæ¯”ç‰¹æ•°ï¼‰ã€‚æ¯”ç‰¹ç‡ï¼ˆåŸå§‹éŸ³é¢‘ PCMï¼‰ &#x3D; é‡‡æ ·é¢‘ç‡ x é‡‡æ ·ä½æ•°  x  å£°é“æ•°ï¼Œè¿™æ˜¯æœªç»å‹ç¼©çš„æ¯”ç‰¹ç‡ï¼Œå‹ç¼©åä¼šè¿œå°äºè¿™ä¸ªå€¼ã€‚<br>â€‹<br>â€‹       é‡‡ç”¨44.1kHzé‡‡æ ·é¢‘ç‡ã€16ä½é‡‡æ ·ä½æ•°ã€åŒå£°é“ç¼–ç çš„åŸå§‹éŸ³é¢‘ PCM æ¯”ç‰¹ç‡ä¸ºï¼š1411.2 kbps ã€‚è€Œæœ€å¸¸è§çš„ mp3 æ ¼å¼çš„æ¯”ç‰¹ç‡ä¸ºï¼š128kbpsï¼Œçº¦ 1MB&#x2F;åˆ†é’Ÿã€‚</p>
<ul>
<li>ç¼–ç æ ¼å¼ï¼š</li>
</ul>
<p>â€‹       å°†åŸå§‹éŸ³é¢‘ PCM é‡‡ç”¨ç‰¹å®šå‹ç¼©ç®—æ³•å¤„ç†åï¼ŒåŠ ä¸Šæ–‡ä»¶å¤´ï¼Œæ‰€ä¿å­˜æˆçš„æ–‡ä»¶çš„æ ¼å¼ã€‚ä¾‹å¦‚ mp3ã€wavã€aacâ€¦</p>
<h2 id="ç¼–ç æ ¼å¼"><a href="#ç¼–ç æ ¼å¼" class="headerlink" title="ç¼–ç æ ¼å¼"></a>ç¼–ç æ ¼å¼</h2><ul>
<li>mp3</li>
</ul>
<p>â€‹       æ˜¯å½“ä»Šæœ€æµè¡Œçš„ä¸€ç§æ•°å­—éŸ³é¢‘ç¼–ç å’Œæœ‰æŸå‹ç¼©æ ¼å¼ï¼Œå°±æ˜¯å°† PCM é€šè¿‡ç®—æ³•è¿›è¡Œå‹ç¼©ï¼Œå¸¸è§„ mp3 æ–‡ä»¶çº¦ä¸º 1MB&#x2F;åˆ†é’Ÿã€‚</p>
<ul>
<li>aac</li>
</ul>
<p>â€‹        æ˜¯ mp3 çš„ä¸‹ä¸€ä»£æ ¼å¼ï¼Œä¹Ÿæ˜¯æœ‰æŸå‹ç¼©ï¼Œç›¸å¯¹äºmp3ï¼Œaac æ ¼å¼çš„éŸ³é¢‘æ›´ä½³ï¼Œæ–‡ä»¶æ›´å°ã€‚ios å¹³å°ä¹Ÿæ”¯æŒï¼Œè·¨å¹³å°æ€§å¥½ã€‚</p>
<ul>
<li>wav</li>
</ul>
<p>â€‹        æœ€æµè¡Œçš„éå‹ç¼©æ•°æ®æ ¼å¼ï¼Œå¾®è½¯å¼€å‘ã€‚</p>
<ul>
<li>amr</li>
</ul>
<p>â€‹        å‹ç¼©æ¯”æ¯”è¾ƒå¤§ï¼Œä½†ç›¸å¯¹å…¶ä»–çš„å‹ç¼©æ ¼å¼è´¨é‡æ¯”è¾ƒå·®ï¼Œå¤šç”¨äºäººå£°ï¼Œé€šè¯å½•éŸ³ã€‚</p>
<blockquote>
<p>riffï¼šä¸€ç§æ–‡ä»¶æè¿°çš„æ ¼å¼ï¼Œwavæ–‡ä»¶å°±é‡‡ç”¨äº†riffæè¿°ï¼Œå‰é¢44å­—èŠ‚å°±æ˜¯ riff æè¿°å†…å®¹ï¼Œå°±æ˜¯æ–‡ä»¶å¤´ã€‚</p>
</blockquote>
<h2 id="MediaRecorder"><a href="#MediaRecorder" class="headerlink" title="MediaRecorder"></a>MediaRecorder</h2><p> é¦–å…ˆåœ¨ AndroidManifest é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å½•éŸ³æƒé™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECORD_AUDIO&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>Android 6.0 ä»¥ä¸Šè¿˜è¦åŠ¨æ€è·å–æƒé™ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½•éŸ³å¯¹è±¡å£°æ˜</span></span><br><span class="line">   <span class="keyword">private</span> MediaRecorder mRecorder;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startRecording</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// åˆ›å»ºå½•éŸ³å¯¹è±¡</span></span><br><span class="line">       mRecorder = <span class="keyword">new</span> <span class="title class_">MediaRecorder</span>();</span><br><span class="line">       <span class="comment">// è®¾ç½®å£°éŸ³æ¥æº MIC å³æ‰‹æœºéº¦å…‹é£</span></span><br><span class="line">       mRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);</span><br><span class="line">       <span class="comment">// è®¾ç½®éŸ³é¢‘æ ¼å¼ aac</span></span><br><span class="line">       mRecorder.setOutputFormat(MediaRecorder.OutputFormat.AAC_ADTS);</span><br><span class="line">       <span class="comment">// è®¾ç½®å½•éŸ³æ–‡ä»¶</span></span><br><span class="line">       mRecorder.setOutputFile(getExternalCacheDir() + <span class="string">&quot;/demo.aac&quot;</span>);</span><br><span class="line">       <span class="comment">// è®¾ç½®ç¼–ç å™¨</span></span><br><span class="line">       mRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// å‡†å¤‡å½•éŸ³</span></span><br><span class="line">           mRecorder.prepare();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// å¼€å§‹å½•éŸ³</span></span><br><span class="line">       mRecorder.start();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>å½•éŸ³æ˜¯è€—æ—¶æ“ä½œï¼Œä½†æ˜¯ï¼Œç”±äº<code>MediaRecorder</code>å·²ç»å°è£…äº†çº¿ç¨‹ï¼Œæ•…ä»¥ä¸Šä»£ç æ”¾åœ¨ä¸»çº¿ç¨‹å³å¯ã€‚<br><code>MediaRecorder</code>æ˜¯å¾ˆå èµ„æºçš„ï¼Œä½¿ç”¨å®Œæ¯•éœ€è¦é‡Šæ”¾æ‰ï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">stopRecording</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// åœæ­¢å½•éŸ³</span></span><br><span class="line">       mRecorder.stop();</span><br><span class="line">       <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">       mRecorder.release();</span><br><span class="line">       <span class="comment">// å¼•ç”¨ç½®ç©º</span></span><br><span class="line">       mRecorder = <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="AudioRecord"><a href="#AudioRecord" class="headerlink" title="AudioRecord"></a>AudioRecord</h2><p>é¦–å…ˆåœ¨ AndroidManifest é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å½•éŸ³æƒé™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECORD_AUDIO&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ Android 6.0 ä»¥ä¸Šè¿˜è¦åŠ¨æ€è·å–æƒé™ï¼Œå…·ä½“å®ç°æ–¹å¼è¯·ç™¾åº¦ä¹‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½•éŸ³çŠ¶æ€</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isRecording</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">startRecording</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// è€—æ—¶æ“ä½œè¦å¼€çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// éŸ³æº</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">audioSource</span> <span class="operator">=</span> MediaRecorder.AudioSource.MIC;</span><br><span class="line">            <span class="comment">// é‡‡æ ·ç‡</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">sampleRate</span> <span class="operator">=</span> <span class="number">44100</span>;</span><br><span class="line">            <span class="comment">// å£°é“æ•°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">channelConfig</span> <span class="operator">=</span> AudioFormat.CHANNEL_IN_STEREO;<span class="comment">//åŒå£°é“</span></span><br><span class="line">            <span class="comment">// é‡‡æ ·ä½æ•°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">audioFormat</span> <span class="operator">=</span> AudioFormat.ENCODING_PCM_16BIT;</span><br><span class="line">            <span class="comment">// è·å–æœ€å°ç¼“å­˜åŒºå¤§å°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">minBufferSize</span> <span class="operator">=</span> AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat);</span><br><span class="line">            <span class="comment">// åˆ›å»ºå½•éŸ³å¯¹è±¡</span></span><br><span class="line">            <span class="type">AudioRecord</span> <span class="variable">audioRecord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AudioRecord</span>(audioSource, sampleRate, channelConfig, audioFormat, minBufferSize);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// åˆ›å»ºéšæœºè¯»å†™æµ</span></span><br><span class="line">                <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(getExternalCacheDir() + <span class="string">&quot;/demo.wav&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">                <span class="comment">// ç•™å‡ºæ–‡ä»¶å¤´çš„ä½ç½®</span></span><br><span class="line">                raf.seek(<span class="number">44</span>);</span><br><span class="line">                <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[minBufferSize];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å½•éŸ³ä¸­</span></span><br><span class="line">                audioRecord.startRecording();</span><br><span class="line">                isRecording = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">while</span> (isRecording) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">readSize</span> <span class="operator">=</span> audioRecord.read(buffer, <span class="number">0</span>, minBufferSize);</span><br><span class="line">                    raf.write(buffer,<span class="number">0</span>,readSize);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å½•éŸ³åœæ­¢</span></span><br><span class="line">                audioRecord.stop();</span><br><span class="line">                audioRecord.release();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å†™æ–‡ä»¶å¤´</span></span><br><span class="line">                WriteWaveFileHeader(raf, raf.length(),sampleRate,<span class="number">2</span>,sampleRate*<span class="number">16</span>*<span class="number">2</span>/<span class="number">8</span>);</span><br><span class="line">                raf.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸º wav æ–‡ä»¶æ·»åŠ æ–‡ä»¶å¤´ï¼Œå‰ææ˜¯åœ¨å¤´éƒ¨é¢„ç•™äº† 44å­—èŠ‚ç©ºé—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> raf</span></span><br><span class="line"><span class="comment">     *              éšæœºè¯»å†™æµ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileLength</span></span><br><span class="line"><span class="comment">     *              æ–‡ä»¶æ€»é•¿</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sampleRate</span></span><br><span class="line"><span class="comment">     *              é‡‡æ ·ç‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channels</span></span><br><span class="line"><span class="comment">     *              å£°é“æ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> byteRate</span></span><br><span class="line"><span class="comment">     *              ç ç‡ = é‡‡æ ·ç‡ * é‡‡æ ·ä½æ•° * å£°é“æ•° / 8</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">WriteWaveFileHeader</span><span class="params">(RandomAccessFile raf, <span class="type">long</span> fileLength, <span class="type">long</span> sampleRate, <span class="type">int</span> channels, <span class="type">long</span> byteRate)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalDataLen</span> <span class="operator">=</span> fileLength + <span class="number">36</span>;</span><br><span class="line">        <span class="type">byte</span>[] header = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">44</span>];</span><br><span class="line">        header[<span class="number">0</span>] = <span class="string">&#x27;R&#x27;</span>; <span class="comment">// RIFF/WAVE header</span></span><br><span class="line">        header[<span class="number">1</span>] = <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">        header[<span class="number">2</span>] = <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">        header[<span class="number">3</span>] = <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">        header[<span class="number">4</span>] = (<span class="type">byte</span>) (totalDataLen &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">5</span>] = (<span class="type">byte</span>) ((totalDataLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">6</span>] = (<span class="type">byte</span>) ((totalDataLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">7</span>] = (<span class="type">byte</span>) ((totalDataLen &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">8</span>] = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">        header[<span class="number">9</span>] = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        header[<span class="number">10</span>] = <span class="string">&#x27;V&#x27;</span>;</span><br><span class="line">        header[<span class="number">11</span>] = <span class="string">&#x27;E&#x27;</span>;</span><br><span class="line">        header[<span class="number">12</span>] = <span class="string">&#x27;f&#x27;</span>; <span class="comment">// &#x27;fmt &#x27; chunk</span></span><br><span class="line">        header[<span class="number">13</span>] = <span class="string">&#x27;m&#x27;</span>;</span><br><span class="line">        header[<span class="number">14</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">        header[<span class="number">15</span>] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        header[<span class="number">16</span>] = <span class="number">16</span>; <span class="comment">// 4 bytes: size of &#x27;fmt &#x27; chunk</span></span><br><span class="line">        header[<span class="number">17</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">18</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">19</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">20</span>] = <span class="number">1</span>; <span class="comment">// format = 1</span></span><br><span class="line">        header[<span class="number">21</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">22</span>] = (<span class="type">byte</span>) channels;</span><br><span class="line">        header[<span class="number">23</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">24</span>] = (<span class="type">byte</span>) (sampleRate &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">25</span>] = (<span class="type">byte</span>) ((sampleRate &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">26</span>] = (<span class="type">byte</span>) ((sampleRate &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">27</span>] = (<span class="type">byte</span>) ((sampleRate &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">28</span>] = (<span class="type">byte</span>) (byteRate &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">29</span>] = (<span class="type">byte</span>) ((byteRate &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">30</span>] = (<span class="type">byte</span>) ((byteRate &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">31</span>] = (<span class="type">byte</span>) ((byteRate &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">32</span>] = (<span class="type">byte</span>) (<span class="number">2</span> * <span class="number">16</span> / <span class="number">8</span>); <span class="comment">// block align</span></span><br><span class="line">        header[<span class="number">33</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">34</span>] = <span class="number">16</span>; <span class="comment">// bits per sample</span></span><br><span class="line">        header[<span class="number">35</span>] = <span class="number">0</span>;</span><br><span class="line">        header[<span class="number">36</span>] = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">        header[<span class="number">37</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        header[<span class="number">38</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">        header[<span class="number">39</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        header[<span class="number">40</span>] = (<span class="type">byte</span>) (fileLength &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">41</span>] = (<span class="type">byte</span>) ((fileLength &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">42</span>] = (<span class="type">byte</span>) ((fileLength &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        header[<span class="number">43</span>] = (<span class="type">byte</span>) ((fileLength &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        raf.seek(<span class="number">0</span>);</span><br><span class="line">        raf.write(header, <span class="number">0</span>, <span class="number">44</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p> ä»¥ä¸‹æ˜¯åœæ­¢å½•éŸ³çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">stopRecording</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="comment">// åœæ­¢å½•éŸ³</span></span><br><span class="line">     isRecording = <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="è¾¹å½•è¾¹æ’­ï¼ˆAudioRecord-AudioTrackï¼‰"><a href="#è¾¹å½•è¾¹æ’­ï¼ˆAudioRecord-AudioTrackï¼‰" class="headerlink" title="è¾¹å½•è¾¹æ’­ï¼ˆAudioRecord + AudioTrackï¼‰"></a>è¾¹å½•è¾¹æ’­ï¼ˆAudioRecord + AudioTrackï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½•éŸ³çŠ¶æ€</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isRecording</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// è€—æ—¶æ“ä½œè¦å¼€çº¿ç¨‹</span></span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// éŸ³æº</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">audioSource</span> <span class="operator">=</span> MediaRecorder.AudioSource.MIC;</span><br><span class="line">               <span class="comment">// é‡‡æ ·ç‡</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">sampleRate</span> <span class="operator">=</span> <span class="number">8000</span>;</span><br><span class="line">               <span class="comment">// å£°é“æ•°</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">channelConfig</span> <span class="operator">=</span> AudioFormat.CHANNEL_IN_STEREO;<span class="comment">//åŒå£°é“</span></span><br><span class="line">               <span class="comment">// é‡‡æ ·ä½æ•°</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">audioFormat</span> <span class="operator">=</span> AudioFormat.ENCODING_PCM_8BIT;</span><br><span class="line">               <span class="comment">// è·å–å½•éŸ³æœ€å°ç¼“å­˜åŒºå¤§å°</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">recorderBufferSize</span> <span class="operator">=</span> AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat);</span><br><span class="line">               <span class="comment">// åˆ›å»ºå½•éŸ³å¯¹è±¡</span></span><br><span class="line">               <span class="type">AudioRecord</span> <span class="variable">audioRecord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AudioRecord</span>(audioSource, sampleRate, channelConfig, audioFormat, recorderBufferSize);</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// éŸ³é¢‘ç±»å‹</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">streamType</span> <span class="operator">=</span> AudioManager.STREAM_MUSIC;</span><br><span class="line">               <span class="comment">// é™æ€éŸ³é¢‘è¿˜æ˜¯éŸ³é¢‘æµ</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">mode</span> <span class="operator">=</span> AudioTrack.MODE_STREAM;</span><br><span class="line">               <span class="comment">//  è·å–æ’­æ”¾æœ€å°ç¼“å­˜åŒºå¤§å°</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">playerBufferSize</span> <span class="operator">=</span> AudioTrack.getMinBufferSize(sampleRate, channelConfig, audioFormat);</span><br><span class="line">               <span class="comment">// åˆ›å»ºæ’­æ”¾å¯¹è±¡</span></span><br><span class="line">               <span class="type">AudioTrack</span> <span class="variable">audioTrack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AudioTrack</span>(streamType, sampleRate, channelConfig, audioFormat, playerBufferSize, mode);</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// ç¼“å­˜åŒº</span></span><br><span class="line">               <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[recorderBufferSize];</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// å½•éŸ³ä¸­</span></span><br><span class="line">               audioTrack.play();</span><br><span class="line">               audioRecord.startRecording();</span><br><span class="line">               isRecording = <span class="literal">true</span>;</span><br><span class="line">               <span class="keyword">while</span> (isRecording) &#123;</span><br><span class="line">                   audioRecord.read(buffer, <span class="number">0</span>, recorderBufferSize);</span><br><span class="line">                   audioTrack.write(buffer, <span class="number">0</span>, buffer.length);</span><br><span class="line">               &#125;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// å½•éŸ³åœæ­¢</span></span><br><span class="line">               audioRecord.stop();</span><br><span class="line">               audioTrack.stop();</span><br><span class="line">               audioRecord.release();</span><br><span class="line">               audioTrack.release();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;.start();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p> åœæ­¢å½•éŸ³å’Œæ’­æ”¾ï¼š</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// åœæ­¢å½•éŸ³</span></span><br><span class="line">       isRecording = <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å½•åˆ¶mp3æ ¼å¼éŸ³é¢‘"><a href="#å½•åˆ¶mp3æ ¼å¼éŸ³é¢‘" class="headerlink" title="å½•åˆ¶mp3æ ¼å¼éŸ³é¢‘"></a>å½•åˆ¶mp3æ ¼å¼éŸ³é¢‘</h2><p> ä¼—å¤šå‘¨çŸ¥ï¼Œmp3 æ˜¯è·¨å¹³å°æ€§æœ€å¥½çš„éŸ³é¢‘æ ¼å¼ï¼Œç”±äºé‡‡ç”¨äº†å‹ç¼©ç‡æ›´é«˜çš„æœ‰æŸå‹ç¼©ç®—æ³•ï¼Œæ–‡ä»¶å¤§å°æ˜¯å¤§çº¦æ¯åˆ†é’Ÿ1Mï¼Œä½¿å…¶åœ¨ç½‘ç»œä¸­ä¼ è¾“æ›´å¿«ï¼Œå ç”¨å­˜å‚¨ç©ºé—´ä¹Ÿæ›´å°‘ï¼›ä¸æ­¤åŒæ—¶ï¼Œå®ƒçš„å£°éŸ³è´¨é‡ä¹Ÿä¸é”™ï¼Œå°¤å…¶æ˜¯äººå£°ï¼ˆç›¸å£°ã€è¯„ä¹¦ã€è„±å£ç§€ï¼‰ï¼Œå½“ç„¶è¿½æ±‚æ— æŸéŸ³ä¹çš„é™¤å¤–ã€‚<br> Android ä¸­æ²¡æœ‰æä¾›å½•åˆ¶ mp3 çš„ APIï¼Œéœ€è¦ä½¿ç”¨å¼€æºåº“ lameï¼Œlame æ˜¯ä¸“é—¨ç”¨äºç¼–ç  mp3 çš„è½»é‡é«˜æ•ˆçš„ c ä»£ç åº“ã€‚ç”±äºé‡‡ç”¨ c è¯­è¨€ç¼–å†™ï¼Œæ•…éœ€è¦ç”¨åˆ° jniã€‚</p>
<h3 id="ä¸‹è½½lameåº“"><a href="#ä¸‹è½½lameåº“" class="headerlink" title="ä¸‹è½½lameåº“"></a>ä¸‹è½½lameåº“</h3><ul>
<li>lameåº“ä¸‹è½½(ä»¥ä¸‹ä½¿ç”¨çš„æ˜¯<code>lame</code> v3.100)<br>  <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/lame/files/lame/">https://sourceforge.net/projects/lame/files/lame/</a></li>
</ul>
<h3 id="æºç å¯¼å…¥"><a href="#æºç å¯¼å…¥" class="headerlink" title="æºç å¯¼å…¥"></a>æºç å¯¼å…¥</h3><p>è§£å‹ä¸‹è½½çš„lameåº“ï¼ŒæŠŠ<code>libmp3lame</code>æ–‡ä»¶å¤¹ä¸‹åç¼€ä¸º<code>.c .h</code>çš„æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬å­æ–‡ä»¶å¤¹i386å’Œvectorä¸‹çš„ï¼‰å¤åˆ¶åˆ°cpp&#x2F;lameæ–‡ä»¶å¤¹å†…ï¼ŒåŒæ—¶æŠŠ<code>include</code>ç›®å½•ä¸‹çš„lame.hä¹Ÿå¤åˆ¶åˆ°cpp&#x2F;lameæ–‡ä»¶å¤¹å†…ï¼Œæ­¤æ—¶ lameæ–‡ä»¶å¤¹å†…åŒ…å«42ä¸ªæ–‡ä»¶ã€‚<br><img src="https://i.loli.net/2019/07/31/5d4157b88dbd619403.png"><br>ï¼ˆå¯å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/xmaihh/MFSocket/tree/master/liblame/src/main/cpp/lame%EF%BC%89">https://github.com/xmaihh/MFSocket/tree/master/liblame/src/main/cpp/lameï¼‰</a></p>
<h3 id="ä¿®æ”¹åº“æ–‡ä»¶"><a href="#ä¿®æ”¹åº“æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹åº“æ–‡ä»¶"></a>ä¿®æ”¹åº“æ–‡ä»¶</h3><p>æ‰“å¼€åˆšåˆšæ‹·è´çš„lameåº“æ–‡ä»¶ï¼Œä¿®æ”¹ï¼š</p>
<ol>
<li>util.h æ–‡ä»¶ï¼ŒæŠŠ 570 è¡Œçš„ä¸¤å¤„ ieee754_float32_t æ”¹ä¸º float  å› ä¸ºAndroidä¸‹å¹¶ä¸æ”¯æŒè¯¥ç±»å‹</li>
<li>set_get.h æ–‡ä»¶ï¼ŒæŠŠå¤´éƒ¨çš„ #include &lt;lame.h&gt; æ”¹ä¸º #include â€œlame.hâ€</li>
<li>fft.c æ–‡ä»¶ï¼Œåˆ é™¤ç¬¬47è¡Œ  #include â€œvector&#x2F;lame_intrin.hâ€</li>
<li>id3tag.cå’Œmachine.hä¸¤ä¸ªæ–‡ä»¶é‡Œï¼Œå°‡HAVE_STRCHRå’ŒHAVE_MEMCPYçš„ifdefç»“æ„ä½“åˆ é™¤æˆ–è€…æ³¨é‡Š</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> STDC_HEADERS</span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="comment">/*# ifndef HAVE_STRCHR</span></span><br><span class="line"><span class="comment">#  define strchr index</span></span><br><span class="line"><span class="comment">#  define strrchr rindex</span></span><br><span class="line"><span class="comment"># endif*/</span></span><br><span class="line"><span class="type">char</span>   *<span class="title function_">strchr</span><span class="params">()</span>, *<span class="title function_">strrchr</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">/*# ifndef HAVE_MEMCPY</span></span><br><span class="line"><span class="comment">#  define memcpy(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="comment">#  define memmove(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="comment"># endif*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>å¯å‚è€ƒä»¥ä¸‹å®Œæ•´ä¿®æ”¹æ–‡ä»¶</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">diff --git a/VbrTag.c b/VbrTag.c</span></span><br><span class="line"><span class="comment">index 5800a44..36ee7b6 100644</span></span><br><span class="line"><span class="comment">--- a/VbrTag.c</span></span><br><span class="line"><span class="comment">+++ b/VbrTag.c</span></span><br><span class="line"><span class="meta">@@ -26,6 +26,8 @@</span></span><br><span class="line"> # include &lt;config.h&gt;</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/bitstream.c b/bitstream.c</span></span><br><span class="line"><span class="comment">index aa35915..a2fe294 100644</span></span><br><span class="line"><span class="comment">--- a/bitstream.c</span></span><br><span class="line"><span class="comment">+++ b/bitstream.c</span></span><br><span class="line"><span class="meta">@@ -29,6 +29,7 @@</span></span><br><span class="line"> </span><br><span class="line"> #include &lt;stdlib.h&gt;</span><br><span class="line"> #include &lt;stdio.h&gt;</span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> </span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"><span class="comment">diff --git a/encoder.c b/encoder.c</span></span><br><span class="line"><span class="comment">index 48f46c7..437067f 100644</span></span><br><span class="line"><span class="comment">--- a/encoder.c</span></span><br><span class="line"><span class="comment">+++ b/encoder.c</span></span><br><span class="line"><span class="meta">@@ -30,6 +30,7 @@</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/fft.c b/fft.c</span></span><br><span class="line"><span class="comment">index 4eea1ad..27febdb 100644</span></span><br><span class="line"><span class="comment">--- a/fft.c</span></span><br><span class="line"><span class="comment">+++ b/fft.c</span></span><br><span class="line"><span class="meta">@@ -44,7 +44,7 @@</span></span><br><span class="line"> #include &quot;util.h&quot;</span><br><span class="line"><span class="comment">--- a/fft.c</span></span><br><span class="line"><span class="comment">+++ b/fft.c</span></span><br><span class="line"><span class="meta">@@ -44,7 +44,7 @@</span></span><br><span class="line"> #include &quot;util.h&quot;</span><br><span class="line"> #include &quot;fft.h&quot;</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-#include &quot;vector/lame_intrin.h&quot;</span></span><br><span class="line"><span class="addition">+//#include &quot;vector/lame_intrin.h&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">diff --git a/id3tag.c b/id3tag.c</span></span><br><span class="line"><span class="comment">index ac48510..8f148b8 100644</span></span><br><span class="line"><span class="comment">--- a/id3tag.c</span></span><br><span class="line"><span class="comment">+++ b/id3tag.c</span></span><br><span class="line"><span class="meta">@@ -41,17 +41,20 @@</span></span><br><span class="line"> # include &lt;string.h&gt;</span><br><span class="line"> # include &lt;ctype.h&gt;</span><br><span class="line"> #else</span><br><span class="line"><span class="deletion">-# ifndef HAVE_STRCHR</span></span><br><span class="line"><span class="deletion">-#  define strchr index</span></span><br><span class="line"><span class="deletion">-#  define strrchr rindex</span></span><br><span class="line"><span class="deletion">-# endif</span></span><br><span class="line"><span class="addition">+//# ifndef HAVE_STRCHR</span></span><br><span class="line"><span class="addition">+//#  define strchr index</span></span><br><span class="line"><span class="addition">+//#  define strrchr rindex</span></span><br><span class="line"><span class="addition">+//# endif</span></span><br><span class="line"> char   *strchr(), *strrchr();</span><br><span class="line"><span class="deletion">-# ifndef HAVE_MEMCPY</span></span><br><span class="line"><span class="deletion">-#  define memcpy(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="deletion">-# endif</span></span><br><span class="line"><span class="addition">+//# ifndef HAVE_MEMCPY</span></span><br><span class="line"><span class="addition">+//#  define memcpy(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="addition">+//# endif</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;malloc.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/lame.c b/lame.c</span></span><br><span class="line"><span class="comment">index cb82225..299fd56 100644</span></span><br><span class="line"><span class="comment">--- a/lame.c</span></span><br><span class="line"><span class="comment">+++ b/lame.c</span></span><br><span class="line"><span class="meta">@@ -31,6 +31,8 @@</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;malloc.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> </span><br><span class="line"><span class="comment">diff --git a/machine.h b/machine.h</span></span><br><span class="line"><span class="comment">index bf6fff2..c675c20 100644</span></span><br><span class="line"><span class="comment">--- a/machine.h</span></span><br><span class="line"><span class="comment">+++ b/machine.h</span></span><br><span class="line"><span class="meta">@@ -31,15 +31,15 @@</span></span><br><span class="line"> # include &lt;stdlib.h&gt;</span><br><span class="line"> # include &lt;string.h&gt;</span><br><span class="line"> #else</span><br><span class="line"><span class="deletion">-# ifndef HAVE_STRCHR</span></span><br><span class="line"><span class="deletion">-#  define strchr index</span></span><br><span class="line"><span class="deletion">-#  define strrchr rindex</span></span><br><span class="line"><span class="deletion">-# endif</span></span><br><span class="line"><span class="addition">+//# ifndef HAVE_STRCHR</span></span><br><span class="line"><span class="addition">+//#  define strchr index</span></span><br><span class="line"><span class="addition">+//#  define strrchr rindex</span></span><br><span class="line"><span class="addition">+//# endif</span></span><br><span class="line"> char   *strchr(), *strrchr();</span><br><span class="line"><span class="deletion">-# ifndef HAVE_MEMCPY</span></span><br><span class="line"><span class="deletion">-#  define memcpy(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="deletion">-#  define memmove(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="deletion">-# endif</span></span><br><span class="line"><span class="addition">+//# ifndef HAVE_MEMCPY</span></span><br><span class="line"><span class="addition">+//#  define memcpy(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="addition">+//#  define memmove(d, s, n) bcopy ((s), (d), (n))</span></span><br><span class="line"><span class="addition">+//# endif</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> #if  defined(__riscos__)  &amp;&amp;  defined(FPA10)</span><br><span class="line"><span class="comment">diff --git a/newmdct.c b/newmdct.c</span></span><br><span class="line"><span class="comment">index 596cac9..ac98abd 100644</span></span><br><span class="line"><span class="comment">--- a/newmdct.c</span></span><br><span class="line"><span class="comment">+++ b/newmdct.c</span></span><br><span class="line"><span class="meta">@@ -30,6 +30,7 @@</span></span><br><span class="line"> # include &lt;config.h&gt;</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/psymodel.c b/psymodel.c</span></span><br><span class="line"><span class="comment">index 60076ee..1393c2a 100644</span></span><br><span class="line"><span class="comment">--- a/psymodel.c</span></span><br><span class="line"><span class="comment">+++ b/psymodel.c</span></span><br><span class="line"><span class="meta">@@ -145,7 +145,8 @@</span> blocktype_d[2]        block type to use for previous granule</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> #include &lt;float.h&gt;</span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/quantize.c b/quantize.c</span></span><br><span class="line"><span class="comment">index 9ba9c16..2906c00 100644</span></span><br><span class="line"><span class="comment">--- a/quantize.c</span></span><br><span class="line"><span class="comment">+++ b/quantize.c</span></span><br><span class="line"><span class="meta">@@ -28,6 +28,8 @@</span></span><br><span class="line"> # include &lt;config.h&gt;</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/quantize_pvt.c b/quantize_pvt.c</span></span><br><span class="line">:</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> #include &lt;float.h&gt;</span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/quantize.c b/quantize.c</span></span><br><span class="line"><span class="comment">index 9ba9c16..2906c00 100644</span></span><br><span class="line"><span class="comment">--- a/quantize.c</span></span><br><span class="line"><span class="comment">+++ b/quantize.c</span></span><br><span class="line"><span class="meta">@@ -28,6 +28,8 @@</span></span><br><span class="line"> # include &lt;config.h&gt;</span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/quantize_pvt.c b/quantize_pvt.c</span></span><br><span class="line"><span class="comment">index d8d6447..3cd9966 100644</span></span><br><span class="line"><span class="comment">--- a/quantize_pvt.c</span></span><br><span class="line"><span class="comment">+++ b/quantize_pvt.c</span></span><br><span class="line"><span class="meta">@@ -36,6 +36,7 @@</span></span><br><span class="line"> #include &quot;reservoir.h&quot;</span><br><span class="line"> #include &quot;lame-analysis.h&quot;</span><br><span class="line"> #include &lt;float.h&gt;</span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> #define NSATHSCALE 100  /* Assuming dynamic range=96dB, this value should be 92 */</span><br><span class="line"><span class="comment">diff --git a/set_get.h b/set_get.h</span></span><br><span class="line"><span class="comment">index 37e4bcd..99ab73c 100644</span></span><br><span class="line"><span class="comment">--- a/set_get.h</span></span><br><span class="line"><span class="comment">+++ b/set_get.h</span></span><br><span class="line"><span class="meta">@@ -21,7 +21,7 @@</span></span><br><span class="line"> #ifndef __SET_GET_H__</span><br><span class="line"> #define __SET_GET_H__</span><br><span class="line"> </span><br><span class="line"><span class="deletion">-#include &lt;lame.h&gt;</span></span><br><span class="line"><span class="addition">+#include &quot;lame.h&quot;</span></span><br><span class="line"> </span><br><span class="line"> #if defined(__cplusplus)</span><br><span class="line"> extern  &quot;C&quot; &#123;</span><br><span class="line"><span class="comment">diff --git a/takehiro.c b/takehiro.c</span></span><br><span class="line"><span class="comment">index 67aba1b..ca02f98 100644</span></span><br><span class="line"><span class="comment">--- a/takehiro.c</span></span><br><span class="line"><span class="comment">+++ b/takehiro.c</span></span><br><span class="line"><span class="meta">@@ -27,6 +27,7 @@</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/util.c b/util.c</span></span><br><span class="line"><span class="comment">index 43b457c..e9255fe 100644</span></span><br><span class="line"><span class="comment">--- a/util.c</span></span><br><span class="line"><span class="comment">+++ b/util.c</span></span><br><span class="line"><span class="meta">@@ -27,6 +27,7 @@</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> #include &lt;float.h&gt;</span><br><span class="line"><span class="addition">+#include &lt;malloc.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br><span class="line"><span class="comment">diff --git a/util.h b/util.h</span></span><br><span class="line"><span class="comment">index 13f0cd4..b6bf306 100644</span></span><br><span class="line"><span class="comment">--- a/util.h</span></span><br><span class="line"><span class="comment">+++ b/util.h</span></span><br><span class="line"><span class="meta">@@ -567,7 +567,7 @@</span> extern  &quot;C&quot; &#123;</span><br><span class="line"> </span><br><span class="line"> /* log/log10 approximations */</span><br><span class="line">     extern void init_log_table(void);</span><br><span class="line"><span class="deletion">-    extern ieee754_float32_t fast_log2(ieee754_float32_t x);</span></span><br><span class="line"><span class="addition">+    extern float fast_log2(float x);</span></span><br><span class="line"> </span><br><span class="line">     int     isResamplingNecessary(SessionConfig_t const* cfg);</span><br><span class="line"> </span><br><span class="line"><span class="comment">diff --git a/vbrquantize.c b/vbrquantize.c</span></span><br><span class="line"><span class="comment">index 0f703b7..60834d3 100644</span></span><br><span class="line"><span class="comment">--- a/vbrquantize.c</span></span><br><span class="line"><span class="comment">+++ b/vbrquantize.c</span></span><br><span class="line"><span class="meta">@@ -27,6 +27,8 @@</span></span><br><span class="line"> #endif</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="addition">+#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="addition">+#include &lt;string.h&gt;</span></span><br><span class="line"> #include &quot;lame.h&quot;</span><br><span class="line"> #include &quot;machine.h&quot;</span><br><span class="line"> #include &quot;encoder.h&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–å†™CmakeList-txt"><a href="#ç¼–å†™CmakeList-txt" class="headerlink" title="ç¼–å†™CmakeList.txt"></a>ç¼–å†™CmakeList.txt</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.6</span>.<span class="number">0</span>)</span><br><span class="line"><span class="keyword">set</span>(CURRENT_DIR <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;CURRENT_DIR:&quot;</span> <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>src/main/cpp/lame)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(LAME_DIR src/main/cpp/lame)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;LAME_DIR:&quot;</span> <span class="variable">$&#123;LAME_DIR&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(src/main/cpp/lame SRC_LIST)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(mp3lame</span><br><span class="line">        SHARED</span><br><span class="line">        src/main/cpp/MP3Recorder.c</span><br><span class="line">        <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#add_library(mp3lame</span></span><br><span class="line"><span class="comment">#        SHARED</span></span><br><span class="line"><span class="comment">#        src/main/cpp/MP3Recorder.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/bitstream.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/fft.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/id3tag.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/mpglib_interface.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/presets.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/quantize.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/reservoir.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/tables.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/util.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/VbrTag.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/encoder.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/gain_analysis.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/lame.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/newmdct.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/psymodel.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/quantize_pvt.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/set_get.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/takehiro.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/vbrquantize.c</span></span><br><span class="line"><span class="comment">#        src/main/cpp/lame/version.c)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">find_library</span>( <span class="comment"># Sets the name of the path variable.</span></span><br><span class="line">        log-lib</span><br><span class="line">        log)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(mp3lame</span><br><span class="line">        <span class="variable">$&#123;log-lib&#125;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ï¼ˆå¯å‚è€ƒ<a target="_blank" rel="noopener" href="https://github.com/xmaihh/MFSocket/blob/master/liblame/CMakeLists.txt%EF%BC%89">https://github.com/xmaihh/MFSocket/blob/master/liblame/CMakeLists.txtï¼‰</a></p>
<h3 id="ç¼–å†™-java-ç±»å’Œ-c-æ–‡ä»¶"><a href="#ç¼–å†™-java-ç±»å’Œ-c-æ–‡ä»¶" class="headerlink" title="ç¼–å†™ java ç±»å’Œ c æ–‡ä»¶"></a>ç¼–å†™ java ç±»å’Œ c æ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MP3Recorder</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">     System.loadLibrary(<span class="string">&quot;mp3lame&quot;</span>);   </span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ– lameç¼–ç å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inSampleRate</span></span><br><span class="line"><span class="comment">     *              è¾“å…¥é‡‡æ ·ç‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outChannel</span></span><br><span class="line"><span class="comment">     *              å£°é“æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outSampleRate</span></span><br><span class="line"><span class="comment">     *              è¾“å‡ºé‡‡æ ·ç‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outBitrate</span></span><br><span class="line"><span class="comment">     *              æ¯”ç‰¹ç‡(kbps)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> quality</span></span><br><span class="line"><span class="comment">     *              0~9ï¼Œ0æœ€å¥½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(<span class="type">int</span> inSampleRate, <span class="type">int</span> outChannel, <span class="type">int</span> outSampleRate, <span class="type">int</span> outBitrate, <span class="type">int</span> quality)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  ç¼–ç ï¼ŒæŠŠ AudioRecord å½•åˆ¶çš„ PCM æ•°æ®è½¬æ¢æˆ mp3 æ ¼å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buffer_l</span></span><br><span class="line"><span class="comment">     *          å·¦å£°é“è¾“å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> buffer_r</span></span><br><span class="line"><span class="comment">     *          å³å£°é“è¾“å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> samples</span></span><br><span class="line"><span class="comment">     *          è¾“å…¥æ•°æ®çš„size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mp3buf</span></span><br><span class="line"><span class="comment">     *          è¾“å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     *          è¾“å‡ºåˆ°mp3bufçš„byteæ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">encode</span><span class="params">(<span class="type">short</span>[] buffer_l, <span class="type">short</span>[] buffer_r, <span class="type">int</span> samples, <span class="type">byte</span>[] mp3buf)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  åˆ·å†™</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mp3buf</span></span><br><span class="line"><span class="comment">     *          mp3æ•°æ®ç¼“å­˜åŒº</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     *          è¿”å›åˆ·å†™çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">flush</span><span class="params">(<span class="type">byte</span>[] mp3buf)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­ lame ç¼–ç å™¨ï¼Œé‡Šæ”¾èµ„æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆ.hæ–‡ä»¶</p>
<p><a href="https://xmaihh.github.io/2019/07/31/AndroidStudio%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90jni%E5%A4%B4%E6%96%87%E4%BB%B6/">AndroidStudioå¿«é€Ÿç”Ÿæˆjniå¤´æ–‡ä»¶</a></p>
<p>ç¼–å†™MP3Recorder.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lame/lame.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MP3Recorder.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> lame_global_flags *glf = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_android_liblame_MP3Recorder</span></span><br><span class="line"><span class="comment"> * Method:    init</span></span><br><span class="line"><span class="comment"> * Signature: (IIIII)V</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">JNIEXPORT <span class="type">void</span> JNICALL <span class="title function_">Java_com_android_liblame_MP3Recorder_init</span></span><br><span class="line">        <span class="params">(JNIEnv *env, jclass instance, jint inSamplerate, jint outChannel, jint outSamplerate,</span></span><br><span class="line"><span class="params">         jint outBitrate, jint quality)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (glf != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        lame_close(glf);</span><br><span class="line">        glf = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    glf = lame_init();</span><br><span class="line">    lame_set_in_samplerate(glf, inSamplerate);</span><br><span class="line">    lame_set_num_channels(glf, outChannel);</span><br><span class="line">    lame_set_out_samplerate(glf, outSamplerate);</span><br><span class="line">    lame_set_brate(glf, outBitrate);</span><br><span class="line">    lame_set_quality(glf, quality);</span><br><span class="line">    lame_init_params(glf);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_android_liblame_MP3Recorder</span></span><br><span class="line"><span class="comment"> * Method:    encode</span></span><br><span class="line"><span class="comment"> * Signature: ([S[SI[B)I</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jint JNICALL <span class="title function_">Java_com_android_liblame_MP3Recorder_encode</span></span><br><span class="line">        <span class="params">(JNIEnv *env, jclass instance, jshortArray buffer_l, jshortArray buffer_r, jint samples,</span></span><br><span class="line"><span class="params">         jbyteArray mp3buf)</span> &#123;</span><br><span class="line">    jshort *j_buffer_l = (*env)-&gt;GetShortArrayElements(env, buffer_l, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    jshort *j_buffer_r = (*env)-&gt;GetShortArrayElements(env, buffer_r, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> jsize mp3buf_size = (*env)-&gt;GetArrayLength(env, mp3buf);</span><br><span class="line">    jbyte *j_mp3buf = (*env)-&gt;GetByteArrayElements(env, mp3buf, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = lame_encode_buffer(glf, j_buffer_l, j_buffer_r,</span><br><span class="line">                                    samples, j_mp3buf, mp3buf_size);</span><br><span class="line"></span><br><span class="line">    (*env)-&gt;ReleaseShortArrayElements(env, buffer_l, j_buffer_l, <span class="number">0</span>);</span><br><span class="line">    (*env)-&gt;ReleaseShortArrayElements(env, buffer_r, j_buffer_r, <span class="number">0</span>);</span><br><span class="line">    (*env)-&gt;ReleaseByteArrayElements(env, mp3buf, j_mp3buf, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_android_liblame_MP3Recorder</span></span><br><span class="line"><span class="comment"> * Method:    flush</span></span><br><span class="line"><span class="comment"> * Signature: ([B)I</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT jint JNICALL <span class="title function_">Java_com_android_liblame_MP3Recorder_flush</span></span><br><span class="line">        <span class="params">(JNIEnv *env, jclass instance, jbyteArray mp3buf)</span> &#123;</span><br><span class="line">    <span class="type">const</span> jsize mp3buf_size = (*env)-&gt;GetArrayLength(env, mp3buf);</span><br><span class="line">    jbyte *j_mp3buf = (*env)-&gt;GetByteArrayElements(env, mp3buf, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = lame_encode_flush(glf, j_mp3buf, mp3buf_size);</span><br><span class="line"></span><br><span class="line">    (*env)-&gt;ReleaseByteArrayElements(env, mp3buf, j_mp3buf, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     com_android_liblame_MP3Recorder</span></span><br><span class="line"><span class="comment"> * Method:    close</span></span><br><span class="line"><span class="comment"> * Signature: ()V</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">JNIEXPORT <span class="type">void</span> JNICALL <span class="title function_">Java_com_android_liblame_MP3Recorder_close</span></span><br><span class="line">        <span class="params">(JNIEnv *env, jclass instance)</span> &#123;</span><br><span class="line">    lame_close(glf);</span><br><span class="line">    glf = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®build-gradle"><a href="#é…ç½®build-gradle" class="headerlink" title="é…ç½®build.gradle"></a>é…ç½®<code>build.gradle</code></h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	....</span><br><span class="line">	...</span><br><span class="line">	..</span><br><span class="line">	.</span><br><span class="line">   <span class="comment">//*</span></span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">            path <span class="string">&quot;CMakeLists.txt&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç‚¹ä¸€ä¸‹å°é”¤å­ :hammer: MakeProjectã€‚</p>
<p>ç¼–è¯‘ç”Ÿæˆ soåº“ã€‚</p>
<h3 id="å½•åˆ¶MP3æ ¼å¼éŸ³é¢‘"><a href="#å½•åˆ¶MP3æ ¼å¼éŸ³é¢‘" class="headerlink" title="å½•åˆ¶MP3æ ¼å¼éŸ³é¢‘"></a>å½•åˆ¶MP3æ ¼å¼éŸ³é¢‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½•éŸ³çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isRecording;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å¼€å§‹å½•éŸ³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="comment">// éŸ³æº</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">audioSource</span> <span class="operator">=</span> MediaRecorder.AudioSource.MIC;</span><br><span class="line">                <span class="comment">// é‡‡æ ·ç‡</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">sampleRate</span> <span class="operator">=</span> <span class="number">44100</span>;</span><br><span class="line">                <span class="comment">// å£°é“</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">channelConfig</span> <span class="operator">=</span> AudioFormat.CHANNEL_IN_MONO;<span class="comment">//å•å£°é“</span></span><br><span class="line">                <span class="comment">// é‡‡æ ·ä½æ•°</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">audioFormat</span> <span class="operator">=</span> AudioFormat.ENCODING_PCM_16BIT;</span><br><span class="line">                <span class="comment">// å½•éŸ³ç¼“å­˜åŒºå¤§å°</span></span><br><span class="line">                <span class="type">int</span> bufferSizeInBytes;</span><br><span class="line">                <span class="comment">// æ–‡ä»¶è¾“å‡ºæµ</span></span><br><span class="line">                FileOutputStream fos;</span><br><span class="line">                <span class="comment">// å½•éŸ³æœ€å°ç¼“å­˜å¤§å°</span></span><br><span class="line">                bufferSizeInBytes = AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat);</span><br><span class="line">                <span class="type">AudioRecord</span> <span class="variable">audioRecord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AudioRecord</span>(audioSource, sampleRate, channelConfig, audioFormat, bufferSizeInBytes);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(getExternalCacheDir() + <span class="string">&quot;/demo.mp3&quot;</span>);</span><br><span class="line">                    MP3Recorder.init(sampleRate, <span class="number">2</span>, sampleRate, <span class="number">128</span>, <span class="number">5</span>);</span><br><span class="line">                    <span class="type">short</span>[] buffer = <span class="keyword">new</span> <span class="title class_">short</span>[bufferSizeInBytes];</span><br><span class="line">                    <span class="type">byte</span>[] mp3buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) (<span class="number">7200</span> + buffer.length * <span class="number">1.25</span>)];</span><br><span class="line">                    audioRecord.startRecording();</span><br><span class="line">                    isRecording = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">while</span> (isRecording &amp;&amp; audioRecord.getRecordingState() == AudioRecord.RECORDSTATE_RECORDING) &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">readSize</span> <span class="operator">=</span> audioRecord.read(buffer, <span class="number">0</span>, bufferSizeInBytes);</span><br><span class="line">                        <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">encodeSize</span> <span class="operator">=</span> MP3Recorder.encode(buffer, buffer, readSize, mp3buffer);</span><br><span class="line">                            <span class="keyword">if</span> (encodeSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    fos.write(mp3buffer, <span class="number">0</span>, encodeSize);</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                                    e.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="type">int</span> <span class="variable">flushSize</span> <span class="operator">=</span> MP3Recorder.flush(mp3buffer);</span><br><span class="line">                    <span class="keyword">if</span> (flushSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            fos.write(mp3buffer, <span class="number">0</span>, flushSize);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fos.close();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    audioRecord.stop();</span><br><span class="line">                    audioRecord.release();</span><br><span class="line">                    MP3Recorder.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"> <span class="comment">// åœæ­¢å½•éŸ³</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        isRecording = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="éŸ³é¢‘è§£ç "><a href="#éŸ³é¢‘è§£ç " class="headerlink" title="éŸ³é¢‘è§£ç "></a>éŸ³é¢‘è§£ç </h1><p> æƒ³è¦è½¬æ¢éŸ³é¢‘æ ¼å¼ï¼ˆå¦‚ mp3æ ¼å¼è½¬ wavæ ¼å¼ï¼‰æˆ–è€…æ·»åŠ èƒŒæ™¯éŸ³ä¹ï¼Œéƒ½éœ€è¦è§£ç å£°éŸ³æ–‡ä»¶ã€‚<br> Android SDK ä¸­æä¾›äº†è§£ç çš„ APIï¼Œå®ƒå°±æ˜¯ MediaCodecï¼Œä¹Ÿå°±æ˜¯éŸ³é¢‘è§£ç å™¨ï¼Œæˆ‘ä»¬ç”¨å®ƒå®ç° mp3æ ¼å¼éŸ³é¢‘çš„è§£ç ï¼š<br>æŠŠmp3æ ¼å¼è½¬wavæ ¼å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startDecoding</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">// å¾…è§£ç å£°éŸ³æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> getExternalCacheDir() + <span class="string">&quot;/bg.mp3&quot;</span>;</span><br><span class="line">       <span class="comment">// éŸ³/è§†é¢‘ æå–å™¨</span></span><br><span class="line">       <span class="type">MediaExtractor</span> <span class="variable">mediaExtractor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaExtractor</span>(); <span class="keyword">try</span> &#123;</span><br><span class="line">           mediaExtractor.setDataSource(filePath);</span><br><span class="line">           <span class="comment">// åˆ†ç¦»éŸ³é¢‘ç”¨çš„ï¼Œè·å–éŸ³é¢‘æ•°æ®</span></span><br><span class="line">           <span class="type">MediaFormat</span> <span class="variable">mediaFormat</span> <span class="operator">=</span> mediaExtractor.getTrackFormat(<span class="number">0</span>);</span><br><span class="line">         <span class="comment">/*// è·å–é‡‡æ ·ç‡</span></span><br><span class="line"><span class="comment">           int sampleRate = mediaFormat.getInteger(MediaFormat.KEY_SAMPLE_RATE);</span></span><br><span class="line"><span class="comment">           // è·å–å£°é“æ•°</span></span><br><span class="line"><span class="comment">           int channelCount = mediaFormat.getInteger(MediaFormat.KEY_CHANNEL_COUNT);</span></span><br><span class="line"><span class="comment">           // è·å–æ—¶é•¿</span></span><br><span class="line"><span class="comment">           long duration = mediaFormat.getLong(MediaFormat.KEY_DURATION);*/</span></span><br><span class="line">           <span class="comment">// è·å–ç±»å‹</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">mime</span> <span class="operator">=</span> mediaFormat.getString(MediaFormat.KEY_MIME);</span><br><span class="line">         <span class="comment">/*System.out.println(&quot;sampleRate:&quot; + sampleRate + &quot;,channelCount:&quot; +</span></span><br><span class="line"><span class="comment">           channelCount + &quot;,duration:&quot; + duration + &quot;,mime:&quot; + mime );*/</span></span><br><span class="line">           </span><br><span class="line">           <span class="comment">// é€‰æ‹©éŸ³è½¨</span></span><br><span class="line">           mediaExtractor.selectTrack(<span class="number">0</span>);</span><br><span class="line">           <span class="comment">// è§£ç å™¨</span></span><br><span class="line">           <span class="type">MediaCodec</span> <span class="variable">mediaCodec</span> <span class="operator">=</span> MediaCodec.createDecoderByType(mime);</span><br><span class="line">           <span class="comment">// é…ç½®è§£ç å™¨</span></span><br><span class="line">           mediaCodec.configure(mediaFormat, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>);</span><br><span class="line">           <span class="comment">// å¼€å§‹è§£ç </span></span><br><span class="line">           mediaCodec.start();</span><br><span class="line">           </span><br><span class="line">           <span class="comment">// è§£ç å™¨åœ¨æ­¤ç¼“å­˜ä¸­è·å–è¾“å…¥æ•°æ®</span></span><br><span class="line">           ByteBuffer[] inputBuffers = mediaCodec.getInputBuffers();</span><br><span class="line">           <span class="comment">// ç¼–ç å™¨å°†è§£ç åçš„æ•°æ®æ”¾å…¥æ­¤ç¼“å­˜ä¸­ï¼Œä¿å­˜çš„æ˜¯pcmæ•°æ®</span></span><br><span class="line">           ByteBuffer[] outputBuffers = mediaCodec.getOutputBuffers();</span><br><span class="line">           <span class="comment">// ç”¨äºæè¿°è§£ç å¾—åˆ°çš„byte[]æ•°æ®çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">           MediaCodec.<span class="type">BufferInfo</span> <span class="variable">bufferInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaCodec</span>.BufferInfo();</span><br><span class="line">           </span><br><span class="line">           <span class="comment">// åˆ›å»ºéšæœºè¯»å†™æµ</span></span><br><span class="line">           <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(getExternalCacheDir() + <span class="string">&quot;/demo.wav&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">           <span class="comment">// ç•™å‡ºæ–‡ä»¶å¤´çš„ä½ç½®</span></span><br><span class="line">           raf.seek(<span class="number">44</span>);</span><br><span class="line">           <span class="comment">// è§£ç çŠ¶æ€</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">isDecoding</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">           main:</span><br><span class="line">           <span class="keyword">while</span> (isDecoding) &#123;</span><br><span class="line">               <span class="keyword">for</span> (ByteBuffer ib : inputBuffers) &#123;</span><br><span class="line">                   <span class="comment">// è·å–è¾“å…¥ç¼“å­˜å™¨</span></span><br><span class="line">                   <span class="type">int</span> <span class="variable">inputIndex</span> <span class="operator">=</span> mediaCodec.dequeueInputBuffer(-<span class="number">1</span>);</span><br><span class="line">                   <span class="keyword">if</span> (inputIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                       <span class="keyword">break</span> main;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="type">ByteBuffer</span> <span class="variable">inputBuffer</span> <span class="operator">=</span> inputBuffers[inputIndex];</span><br><span class="line">                   <span class="comment">// è¯»å–æ•°æ®åˆ°è¾“å…¥ç¼“å­˜å™¨</span></span><br><span class="line">                   <span class="type">int</span> <span class="variable">sampleSize</span> <span class="operator">=</span> mediaExtractor.readSampleData(inputBuffer, <span class="number">0</span>);</span><br><span class="line">                   <span class="keyword">if</span> (sampleSize &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                       isDecoding = <span class="literal">false</span>;</span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                       <span class="comment">// é€šçŸ¥è§£ç å™¨è¾“å…¥äº†æ•°æ®</span></span><br><span class="line">                       mediaCodec.queueInputBuffer(inputIndex, <span class="number">0</span>, sampleSize, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                       <span class="comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€å–æ ·å¤„</span></span><br><span class="line">                       mediaExtractor.advance();</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// è·å–è¾“å‡ºç¼“å­˜å™¨</span></span><br><span class="line">               <span class="type">int</span> <span class="variable">outputIndex</span> <span class="operator">=</span> mediaCodec.dequeueOutputBuffer(bufferInfo, <span class="number">10000</span>);</span><br><span class="line">               <span class="keyword">if</span> (outputIndex == -<span class="number">2</span>) &#123;</span><br><span class="line">                   <span class="comment">// æ ¼å¼å˜äº†ï¼Œé‡æ–°è·å–ä¸€æ¬¡</span></span><br><span class="line">                   outputIndex = mediaCodec.dequeueOutputBuffer(bufferInfo, <span class="number">10000</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">// æ‹¿åˆ°ç”¨äºå­˜æ”¾PCMæ•°æ®çš„buffer</span></span><br><span class="line">               ByteBuffer outputBuffer;</span><br><span class="line">               <span class="comment">// PCMæ•°æ®</span></span><br><span class="line">               <span class="type">byte</span>[] chunckPCM;</span><br><span class="line">               </span><br><span class="line">               <span class="keyword">while</span> (outputIndex &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                   <span class="comment">// æ‹¿åˆ°ç”¨äºå­˜æ”¾PCMæ•°æ®çš„buffer</span></span><br><span class="line">                   outputBuffer = outputBuffers[outputIndex];</span><br><span class="line">                   <span class="comment">// bufferInfo å®šä¹‰äº†æ¬¡æ•°æ®å—çš„å¤§å°</span></span><br><span class="line">                   chunckPCM = <span class="keyword">new</span> <span class="title class_">byte</span>[bufferInfo.size];</span><br><span class="line">                   <span class="comment">// å°†bufferå†…çš„æ•°æ®å–å‡ºåˆ°å­—èŠ‚æ•°ç»„ä¸­</span></span><br><span class="line">                   outputBuffer.get(chunckPCM);</span><br><span class="line">                   <span class="comment">// æ•°æ®å–å‡ºåï¼Œä¸€å®šè®°å¾—æ¸…ç©ºï¼ŒmediaCodecæ˜¯åå¤ä½¿ç”¨è¿™äº›bufferçš„</span></span><br><span class="line">                   outputBuffer.clear();</span><br><span class="line">                   <span class="comment">// è¾“å‡ºPCMæ•°æ®åˆ°æ–‡ä»¶å¤¹</span></span><br><span class="line">                   raf.write(chunckPCM, <span class="number">0</span>, bufferInfo.size);</span><br><span class="line">                   <span class="comment">// é‡Šæ”¾è¾“å‡ºbufferï¼Œä¸ç„¶mediaCodecç”¨å®Œæ‰€æœ‰bufferåï¼Œå°±ä¸å†å‘å¤–è¾“å‡ºæ•°æ®</span></span><br><span class="line">                   mediaCodec.releaseOutputBuffer(outputIndex, <span class="literal">false</span>);</span><br><span class="line">                   <span class="comment">// å†æ¬¡è·å–æ•°æ®,å¦‚æœæ²¡æœ‰æ•°æ®åˆ™outputIndex=-1,ç»“æŸå¾ªç¯</span></span><br><span class="line">                   outputIndex = mediaCodec.dequeueOutputBuffer(bufferInfo, <span class="number">10000</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               </span><br><span class="line">           &#125;</span><br><span class="line">           WriteWaveFileHeader(raf, raf.length(), <span class="number">44100</span>, <span class="number">1</span>, <span class="number">44100</span> * <span class="number">16</span> / <span class="number">8</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¸º wav æ–‡ä»¶æ·»åŠ æ–‡ä»¶å¤´ï¼Œå‰ææ˜¯åœ¨å¤´éƒ¨é¢„ç•™äº† 44å­—èŠ‚ç©ºé—´</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> raf        éšæœºè¯»å†™æµ</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileLength æ–‡ä»¶æ€»é•¿</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> sampleRate é‡‡æ ·ç‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> channels   å£°é“æ•°é‡</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> byteRate   ç ç‡ = é‡‡æ ·ç‡ * é‡‡æ ·ä½æ•° * å£°é“æ•° / 8</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">WriteWaveFileHeader</span><span class="params">(RandomAccessFile raf, <span class="type">long</span> fileLength, <span class="type">long</span> sampleRate, <span class="type">int</span> channels, <span class="type">long</span> byteRate)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="type">long</span> <span class="variable">totalDataLen</span> <span class="operator">=</span> fileLength + <span class="number">36</span>;</span><br><span class="line">       <span class="type">byte</span>[] header = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">44</span>];</span><br><span class="line">       header[<span class="number">0</span>] = <span class="string">&#x27;R&#x27;</span>; <span class="comment">// RIFF/WAVE header</span></span><br><span class="line">       header[<span class="number">1</span>] = <span class="string">&#x27;I&#x27;</span>;</span><br><span class="line">       header[<span class="number">2</span>] = <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">       header[<span class="number">3</span>] = <span class="string">&#x27;F&#x27;</span>;</span><br><span class="line">       header[<span class="number">4</span>] = (<span class="type">byte</span>) (totalDataLen &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">5</span>] = (<span class="type">byte</span>) ((totalDataLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">6</span>] = (<span class="type">byte</span>) ((totalDataLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">7</span>] = (<span class="type">byte</span>) ((totalDataLen &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">8</span>] = <span class="string">&#x27;W&#x27;</span>;</span><br><span class="line">       header[<span class="number">9</span>] = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">       header[<span class="number">10</span>] = <span class="string">&#x27;V&#x27;</span>;</span><br><span class="line">       header[<span class="number">11</span>] = <span class="string">&#x27;E&#x27;</span>;</span><br><span class="line">       header[<span class="number">12</span>] = <span class="string">&#x27;f&#x27;</span>; <span class="comment">// &#x27;fmt &#x27; chunk</span></span><br><span class="line">       header[<span class="number">13</span>] = <span class="string">&#x27;m&#x27;</span>;</span><br><span class="line">       header[<span class="number">14</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">       header[<span class="number">15</span>] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">       header[<span class="number">16</span>] = <span class="number">16</span>; <span class="comment">// 4 bytes: size of &#x27;fmt &#x27; chunk</span></span><br><span class="line">       header[<span class="number">17</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">18</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">19</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">20</span>] = <span class="number">1</span>; <span class="comment">// format = 1</span></span><br><span class="line">       header[<span class="number">21</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">22</span>] = (<span class="type">byte</span>) channels;</span><br><span class="line">       header[<span class="number">23</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">24</span>] = (<span class="type">byte</span>) (sampleRate &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">25</span>] = (<span class="type">byte</span>) ((sampleRate &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">26</span>] = (<span class="type">byte</span>) ((sampleRate &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">27</span>] = (<span class="type">byte</span>) ((sampleRate &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">28</span>] = (<span class="type">byte</span>) (byteRate &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">29</span>] = (<span class="type">byte</span>) ((byteRate &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">30</span>] = (<span class="type">byte</span>) ((byteRate &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">31</span>] = (<span class="type">byte</span>) ((byteRate &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">32</span>] = (<span class="type">byte</span>) (<span class="number">2</span> * <span class="number">16</span> / <span class="number">8</span>); <span class="comment">// block align</span></span><br><span class="line">       header[<span class="number">33</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">34</span>] = <span class="number">16</span>; <span class="comment">// bits per sample</span></span><br><span class="line">       header[<span class="number">35</span>] = <span class="number">0</span>;</span><br><span class="line">       header[<span class="number">36</span>] = <span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">       header[<span class="number">37</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">       header[<span class="number">38</span>] = <span class="string">&#x27;t&#x27;</span>;</span><br><span class="line">       header[<span class="number">39</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">       header[<span class="number">40</span>] = (<span class="type">byte</span>) (fileLength &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">41</span>] = (<span class="type">byte</span>) ((fileLength &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">42</span>] = (<span class="type">byte</span>) ((fileLength &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       header[<span class="number">43</span>] = (<span class="type">byte</span>) ((fileLength &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">       raf.seek(<span class="number">0</span>);</span><br><span class="line">       raf.write(header, <span class="number">0</span>, <span class="number">44</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="å½•éŸ³æ·»åŠ èƒŒæ™¯éŸ³ä¹å¹¶å®æ—¶æ’­æ”¾ï¼Œç±»ä¼¼Kæ­Œæ•ˆæœ"><a href="#å½•éŸ³æ·»åŠ èƒŒæ™¯éŸ³ä¹å¹¶å®æ—¶æ’­æ”¾ï¼Œç±»ä¼¼Kæ­Œæ•ˆæœ" class="headerlink" title="å½•éŸ³æ·»åŠ èƒŒæ™¯éŸ³ä¹å¹¶å®æ—¶æ’­æ”¾ï¼Œç±»ä¼¼Kæ­Œæ•ˆæœ"></a>å½•éŸ³æ·»åŠ èƒŒæ™¯éŸ³ä¹å¹¶å®æ—¶æ’­æ”¾ï¼Œç±»ä¼¼Kæ­Œæ•ˆæœ</h1><p>Kæ­Œç±» APP éƒ½æ˜¯å½•éŸ³åŠ ä¼´å¥ï¼Œè¿™é‡Œå®ç° mp3 æ ¼å¼çš„èƒŒæ™¯éŸ³ä¹è§£ç ï¼Œä¸å½•éŸ³åˆå¹¶ï¼Œå¹¶æœ€ç»ˆè¾“å‡º mp3 æ ¼å¼çš„æ–‡ä»¶ã€‚å³è¾¹å½•éŸ³è¾¹è§£ç è¾¹åˆæˆï¼Œå½•éŸ³ç»“æŸå³åˆå¹¶ç»“æŸã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å½•éŸ³çŠ¶æ€</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> isRecording;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¼€å§‹å½•éŸ³</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// éŸ³æº</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">audioSource</span> <span class="operator">=</span> MediaRecorder.AudioSource.MIC;</span><br><span class="line">            <span class="comment">// é‡‡æ ·ç‡</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">sampleRate</span> <span class="operator">=</span> <span class="number">44100</span>;</span><br><span class="line">            <span class="comment">// å£°é“</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">channelConfig</span> <span class="operator">=</span> AudioFormat.CHANNEL_IN_MONO;<span class="comment">//å•å£°é“</span></span><br><span class="line">            <span class="comment">// é‡‡æ ·ä½æ•°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">audioFormat</span> <span class="operator">=</span> AudioFormat.ENCODING_PCM_16BIT;</span><br><span class="line">            <span class="comment">// å½•éŸ³æœ€å°ç¼“å­˜åŒºå¤§å°</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">bufferSizeInBytes</span> <span class="operator">=</span> AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat);</span><br><span class="line">            <span class="comment">// å½•éŸ³å¯¹è±¡</span></span><br><span class="line">            <span class="type">AudioRecord</span> <span class="variable">audioRecord</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AudioRecord</span>(audioSource, sampleRate, channelConfig, audioFormat, bufferSizeInBytes);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// éŸ³è½¨æå–å™¨</span></span><br><span class="line">                <span class="type">MediaExtractor</span> <span class="variable">mediaExtractor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaExtractor</span>();</span><br><span class="line">                <span class="comment">// ç»™éŸ³è½¨æå–å™¨è®¾ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">                mediaExtractor.setDataSource(getExternalCacheDir() + <span class="string">&quot;/bg.mp3&quot;</span>);</span><br><span class="line">                <span class="comment">// è·å–éŸ³é¢‘æ ¼å¼ä¿¡æ¯</span></span><br><span class="line">                <span class="type">MediaFormat</span> <span class="variable">mediaFormat</span> <span class="operator">=</span> mediaExtractor.getTrackFormat(<span class="number">0</span>);</span><br><span class="line">                <span class="comment">// è·å–éŸ³é¢‘ç±»å‹</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">mime</span> <span class="operator">=</span> mediaFormat.getString(MediaFormat.KEY_MIME);</span><br><span class="line">                <span class="comment">// é€‰ä¸­éŸ³è½¨</span></span><br><span class="line">                mediaExtractor.selectTrack(<span class="number">0</span>);</span><br><span class="line">                <span class="comment">// æ„é€ è§£ç å™¨</span></span><br><span class="line">                <span class="type">MediaCodec</span> <span class="variable">mediaCodec</span> <span class="operator">=</span> MediaCodec.createDecoderByType(mime);</span><br><span class="line">                <span class="comment">// é…ç½®è§£ç å™¨</span></span><br><span class="line">                mediaCodec.configure(mediaFormat, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="comment">// å¼€å§‹è§£ç </span></span><br><span class="line">                mediaCodec.start();</span><br><span class="line">                <span class="comment">// è§£ç å™¨åœ¨æ­¤ç¼“å­˜ä¸­è·å–è¾“å…¥æ•°æ®</span></span><br><span class="line">                ByteBuffer[] inputBuffers = mediaCodec.getInputBuffers();</span><br><span class="line">                <span class="comment">// ç¼–ç å™¨å°†è§£ç åçš„æ•°æ®æ”¾å…¥æ­¤ç¼“å­˜ä¸­ï¼Œå­˜æ”¾çš„æ˜¯pcmæ•°æ®</span></span><br><span class="line">                ByteBuffer[] outputBuffers = mediaCodec.getOutputBuffers();</span><br><span class="line">                <span class="comment">// ç”¨äºæè¿°è§£ç å¾—åˆ°çš„byte[]æ•°æ®çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">                MediaCodec.<span class="type">BufferInfo</span> <span class="variable">bufferInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaCodec</span>.BufferInfo();</span><br><span class="line">                <span class="comment">// èƒŒæ™¯éŸ³ä¹è§£ç åçš„æ•°æ®è¾“å‡ºæµï¼Œå…ˆå­˜å‚¨ï¼Œç„¶åè¯»å–å†å’Œå½•éŸ³åˆå¹¶</span></span><br><span class="line">                <span class="type">FileOutputStream</span> <span class="variable">fos_wav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(getExternalCacheDir() + <span class="string">&quot;/demo.wav&quot;</span>);</span><br><span class="line">                <span class="comment">// è¯»å–å¤„ç†å¥½çš„èƒŒæ™¯éŸ³ä¹ï¼Œå’Œå½•éŸ³åˆå¹¶</span></span><br><span class="line">                <span class="type">RandomAccessFile</span> <span class="variable">raf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(getExternalCacheDir() + <span class="string">&quot;/demo.wav&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">                <span class="comment">// èƒŒæ™¯éŸ³å­—èŠ‚æ•°</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="comment">// å­˜å‚¨å¤§å°ç«¯</span></span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isBigEnding</span> <span class="operator">=</span> ByteOrder.nativeOrder() == ByteOrder.BIG_ENDIAN;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å½•éŸ³ç¼“å­˜</span></span><br><span class="line">                <span class="type">short</span>[] buffer = <span class="keyword">new</span> <span class="title class_">short</span>[bufferSizeInBytes];</span><br><span class="line">                <span class="comment">// æœ€ç»ˆç”Ÿæˆçš„mp3æ•°æ®çš„ç¼“å­˜å™¨</span></span><br><span class="line">                <span class="type">byte</span>[] mp3buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) (<span class="number">7200</span> + buffer.length * <span class="number">1.25</span>)];</span><br><span class="line">                <span class="comment">// å¼€å§‹å½•éŸ³</span></span><br><span class="line">                audioRecord.startRecording();</span><br><span class="line">                <span class="comment">// å½•éŸ³çŠ¶æ€</span></span><br><span class="line">                isRecording = <span class="literal">true</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// æœ€ç»ˆæ–‡ä»¶è¾“å‡ºæµ</span></span><br><span class="line">                <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(getExternalCacheDir() + <span class="string">&quot;/demo.mp3&quot;</span>);</span><br><span class="line">                <span class="comment">// mp3ç¼–ç å™¨åˆå§‹åŒ–</span></span><br><span class="line">                MP3Recorder.init(sampleRate, <span class="number">1</span>, sampleRate, <span class="number">128</span>, <span class="number">5</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">while</span> (isRecording) &#123;</span><br><span class="line">                    <span class="comment">// è¯»å–å½•éŸ³</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">readSize</span> <span class="operator">=</span> audioRecord.read(buffer, <span class="number">0</span>, bufferSizeInBytes);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// è§£ç èƒŒæ™¯éŸ³ä¹</span></span><br><span class="line">                    <span class="keyword">for</span> (ByteBuffer ib : inputBuffers) &#123;</span><br><span class="line">                        <span class="comment">// è·å–è¾“å…¥ç¼“å­˜å™¨</span></span><br><span class="line">                        <span class="type">int</span> <span class="variable">inputIndex</span> <span class="operator">=</span> mediaCodec.dequeueInputBuffer(<span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">if</span> (inputIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="type">ByteBuffer</span> <span class="variable">inputBuffer</span> <span class="operator">=</span> inputBuffers[inputIndex];</span><br><span class="line">                        <span class="comment">// è¯»å–æ•°æ®åˆ°è¾“å…¥ç¼“å­˜å™¨</span></span><br><span class="line">                        <span class="type">int</span> <span class="variable">sampleSize</span> <span class="operator">=</span> mediaExtractor.readSampleData(inputBuffer, <span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">if</span> (sampleSize &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">// é€šçŸ¥è§£ç å™¨è¾“å…¥äº†æ•°æ®</span></span><br><span class="line">                            mediaCodec.queueInputBuffer(inputIndex, <span class="number">0</span>, sampleSize, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                            <span class="comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€å–æ ·å¤„</span></span><br><span class="line">                            mediaExtractor.advance();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// è¾“å‡ºç¼“å­˜å™¨</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">outputIndex</span> <span class="operator">=</span> mediaCodec.dequeueOutputBuffer(bufferInfo, <span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span> (outputIndex == -<span class="number">2</span>) &#123;</span><br><span class="line">                        <span class="comment">// æ ¼å¼å˜äº†ï¼Œé‡æ–°è·å–ä¸€æ¬¡</span></span><br><span class="line">                        outputIndex = mediaCodec.dequeueOutputBuffer(bufferInfo, <span class="number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// æ‹¿åˆ°ç”¨äºå­˜æ”¾PCMæ•°æ®çš„buffer</span></span><br><span class="line">                    ByteBuffer outputBuffer;</span><br><span class="line">                    <span class="comment">// PCMæ•°æ®</span></span><br><span class="line">                    <span class="type">byte</span>[] chunckPCM;</span><br><span class="line">                    <span class="comment">// å¾ªç¯è¯»å–è§£ç æ•°æ®</span></span><br><span class="line">                    <span class="keyword">while</span> (outputIndex &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// æ‹¿åˆ°ç”¨äºå­˜æ”¾PCMæ•°æ®çš„buffer</span></span><br><span class="line">                        outputBuffer = outputBuffers[outputIndex];</span><br><span class="line">                        <span class="comment">// bufferInfo å®šä¹‰äº†æ•°æ®å—çš„å¤§å°</span></span><br><span class="line">                        chunckPCM = <span class="keyword">new</span> <span class="title class_">byte</span>[bufferInfo.size];</span><br><span class="line">                        <span class="comment">// å°†bufferå†…çš„æ•°æ®å–å‡ºåˆ°å­—èŠ‚æ•°ç»„ä¸­</span></span><br><span class="line">                        outputBuffer.get(chunckPCM);</span><br><span class="line">                        <span class="comment">// æ•°æ®å–å‡ºåï¼Œä¸€å®šè®°å¾—æ¸…ç©ºï¼ŒmediaCodecæ˜¯åå¤ä½¿ç”¨è¿™äº›bufferçš„</span></span><br><span class="line">                        outputBuffer.clear();</span><br><span class="line">                        <span class="comment">// è¾“å‡ºPCMæ•°æ®åˆ°æ–‡ä»¶å¤¹</span></span><br><span class="line">                        fos_wav.write(chunckPCM, <span class="number">0</span>, bufferInfo.size);</span><br><span class="line">                        <span class="comment">// èƒŒæ™¯éŸ³å­—èŠ‚æ•°ï¼ˆè§£ç åçš„ï¼‰</span></span><br><span class="line">                        length += bufferInfo.size;</span><br><span class="line">                        <span class="comment">// é‡Šæ”¾è¾“å‡ºbufferï¼Œä¸ç„¶mediaCodecç”¨å®Œæ‰€æœ‰bufferåï¼Œå°±ä¸å†å‘å¤–è¾“å‡ºæ•°æ®</span></span><br><span class="line">                        mediaCodec.releaseOutputBuffer(outputIndex, <span class="literal">false</span>);</span><br><span class="line">                        <span class="comment">// å†æ¬¡è·å–æ•°æ®,å¦‚æœæ²¡æœ‰æ•°æ®åˆ™outputIndex=-1,ç»“æŸå¾ªç¯</span></span><br><span class="line">                        outputIndex = mediaCodec.dequeueOutputBuffer(bufferInfo, <span class="number">0</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// æ··éŸ³</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buffer.length; i++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (raf.getFilePointer() &gt;= length - <span class="number">1</span>) &#123;</span><br><span class="line">                            raf.seek(<span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (isBigEnding) &#123;</span><br><span class="line">                            buffer[i] += (<span class="type">short</span>) ((raf.read() &lt;&lt; <span class="number">8</span>) + raf.read());</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            buffer[i] += (<span class="type">short</span>) (raf.read() + (raf.read() &lt;&lt; <span class="number">8</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> (readSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="type">int</span> <span class="variable">encodeSize</span> <span class="operator">=</span> MP3Recorder.encode(buffer, buffer, readSize, mp3buffer);</span><br><span class="line">                        <span class="keyword">if</span> (encodeSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                fos.write(mp3buffer, <span class="number">0</span>, encodeSize);</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                                e.printStackTrace();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="type">int</span> <span class="variable">flushSize</span> <span class="operator">=</span> MP3Recorder.flush(mp3buffer);</span><br><span class="line">                <span class="keyword">if</span> (flushSize &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        fos.write(mp3buffer, <span class="number">0</span>, flushSize);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                    raf.close();</span><br><span class="line">                    fos_wav.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                audioRecord.stop();</span><br><span class="line">                audioRecord.release();</span><br><span class="line">                MP3Recorder.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">    isRecording = <span class="literal">false</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a target="_blank" rel="noopener" href="http://blog.elight.cn/?post=200">Android å½•éŸ³è¯¦è§£ï¼ˆä¸€ï¼‰â€”â€” MediaRecorderã€AudioRecordã€ç”Ÿæˆwavæ ¼å¼ã€è¾¹å½•è¾¹æ’­</a><br><a target="_blank" rel="noopener" href="http://blog.elight.cn/?post=201">Android å½•éŸ³è¯¦è§£ï¼ˆäºŒï¼‰â€”â€” å½•åˆ¶ mp3 æ ¼å¼éŸ³é¢‘ï¼ˆ lame åº“çš„ç¼–è¯‘åŠä½¿ç”¨ï¼‰</a><br><a target="_blank" rel="noopener" href="http://blog.elight.cn/?post=213">Android å½•éŸ³è¯¦è§£ï¼ˆä¸‰ï¼‰â€”â€” éŸ³é¢‘è§£ç </a><br><a target="_blank" rel="noopener" href="http://blog.elight.cn/?post=220">Android å½•éŸ³è¯¦è§£ï¼ˆå››ï¼‰â€”â€” å½•éŸ³æ·»åŠ èƒŒæ™¯éŸ³ä¹</a></p>
</div><div class="post-copyright"><script type="text/javascript" src="/blog/js/copyright.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/blog/css/copyright.css?v=1.0.0"><p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>Androidå½•éŸ³</p><p><span>æ–‡ç« ä½œè€…ï¼š</span>xmaihh</p><p><span>å‘å¸ƒæ—¶é—´ï¼š</span>2019-07-30</p><p><span>æœ€åæ›´æ–°ï¼š</span>2019-07-30</p><p><span>åŸå§‹é“¾æ¥ï¼š</span><a href="/2019/07/30/android-lu-yin/">https://xmaihh.github.io/blog/2019/07/30/android-lu-yin/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://xmaihh.github.io/blog/2019/07/30/android-lu-yin/"></i></span></p><p><span>ç‰ˆæƒå£°æ˜ï¼š</span>é‡‡ç”¨<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">[CC BY-NC-SA 4.0è®¸å¯åè®®]</a>è¿›è¡Œè®¸å¯</p></div><br><script type="text/javascript" src="/blog/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://xmaihh.github.io/blog/2019/07/30/android-lu-yin/" data-id="cm2e1ez3g0023f1q18w6b91y4" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMklEQVR42u3aQW7DMAwF0d7/0i7QbSB7PukUEDVaBUYc63nBUCR/fvC6/ha5fn2s+7s+P6/uemHJkCFjW8Z1u8iDV7/Gr6++Q/YmQ4aMcxgkLPLH8G2R6+gPQIYMGTJACnif0pEtypAhQ8a7AZccU3miyVNPGTJknMxIkzwSKEkIrqWeMmTIOI2RNgb+8/MX+xsyZMjYhHGFi5f+O6Ez3pUMGTJGM+7LXrXRijSJ5KnhQziWIUPGaEatxNZ/WBrKW5msDBkyNmf0m5G1lmc6LPtQyJMhQ8ZQRnrUTIvytTYneUHLs7gMGTLGMXjI+165jfBqgVuGDBnzGOkBst9IqBXgguEwGTJkDGWkwxadjfJAHKSGMmTIGMfgJf70p/n7Iy/oIT2VIUPGAYx0hJTfVRspSxNTGTJkzGbUAmgnoeRDGLU0VIYMGVMZJMzVivUkQew3MmXIkDGbwR9fC4skTeTfWSJlyJAxmsEPpWlLsjOiUWxhypAh4wBGiqmF3dpBF71EGTJkDGWQ1mONWms51JoEMmTIOIHRh6WBOH3WwwuSIUPGaAYvzdeyTj4qQQJxkOHKkCFjEOMKV7/B2WmILkO5DBkyRjP46o9z9TfaCdMyZMjYnZEGWd5cTIe9is1LGTJkHMNIm4u1Ul2tzYkCugwZMmTgsTBycE1TRhK4ZciQIYOkhiRAdxoMaDhMhgwZoxn9xK4TUnmB74VOrAwZMjZkdBoDfFu1oY2XMTJkyNiP8Qt4Fzf1BrswawAAAABJRU5ErkJggg==">åˆ†äº«</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Android/" rel="tag">Android</a></li></ul></div><div class="post-nav"><a class="pre" href="/blog/2019/07/31/androidstudio-kuai-su-sheng-cheng-jni-tou-wen-jian/">AndroidStudioå¿«é€Ÿç”Ÿæˆjniå¤´æ–‡ä»¶</a><a class="next" href="/blog/2019/07/19/ubuntu18-04-2lts-xia-wireshark-bao-cuo-permission-denied/">Ubuntu18.04.2LTSä¸‹WiresharkæŠ¥é”™Permission denied</a></div><div class="nofancybox" id="vcomment"></div><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'false' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'WyoZPeMWzhLWRYAeA5ueZwiI-MdYXbMMI',
  appKey:'2n4nqRtMlbjNwRNodC3rPRQI',
  serverURLs:'https://wyozpemw.api.lncldglobal.com',
  placeholder:'Just so so',
  avatar:'robohash',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/blog/img/avatar.svg"/></a><p>äº²è‡ªéƒ¨ç½² äº²è‡ªæŒ‡æŒ¥</p><a class="info-icon" href="https://github.com/xmaihh" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/blog/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/">æŠ€æœ¯åˆ†äº«</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/blog/tags/Android/" style="font-size: 15px;">Android</a> <a href="/blog/tags/ADB/" style="font-size: 15px;">ADB</a> <a href="/blog/tags/ANR/" style="font-size: 15px;">ANR</a> <a href="/blog/tags/BLE/" style="font-size: 15px;">BLE</a> <a href="/blog/tags/Lottie/" style="font-size: 15px;">Lottie</a> <a href="/blog/tags/OTA/" style="font-size: 15px;">OTA</a> <a href="/blog/tags/SDK/" style="font-size: 15px;">SDK</a> <a href="/blog/tags/Logcat/" style="font-size: 15px;">Logcat</a> <a href="/blog/tags/AndroidStudio/" style="font-size: 15px;">AndroidStudio</a> <a href="/blog/tags/Jni/" style="font-size: 15px;">Jni</a> <a href="/blog/tags/Serialport/" style="font-size: 15px;">Serialport</a> <a href="/blog/tags/Java/" style="font-size: 15px;">Java</a> <a href="/blog/tags/BT/" style="font-size: 15px;">BT</a> <a href="/blog/tags/RS232/" style="font-size: 15px;">RS232</a> <a href="/blog/tags/Archlinux/" style="font-size: 15px;">Archlinux</a> <a href="/blog/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/blog/tags/ArkUI/" style="font-size: 15px;">ArkUI</a> <a href="/blog/tags/Harmony/" style="font-size: 15px;">Harmony</a> <a href="/blog/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/blog/tags/Cloudflare/" style="font-size: 15px;">Cloudflare</a> <a href="/blog/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/blog/tags/docker-compose/" style="font-size: 15px;">docker-compose</a> <a href="/blog/tags/Debian/" style="font-size: 15px;">Debian</a> <a href="/blog/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a> <a href="/blog/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/blog/tags/Frp/" style="font-size: 15px;">Frp</a> <a href="/blog/tags/Github-Actions/" style="font-size: 15px;">Github Actions</a> <a href="/blog/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/blog/tags/CI-CD/" style="font-size: 15px;">CI/CD</a> <a href="/blog/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/blog/tags/Portainer/" style="font-size: 15px;">Portainer</a> <a href="/blog/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/blog/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/blog/tags/ArchLinux/" style="font-size: 15px;">ArchLinux</a> <a href="/blog/tags/Pixel8/" style="font-size: 15px;">Pixel8</a> <a href="/blog/tags/Magisk/" style="font-size: 15px;">Magisk</a> <a href="/blog/tags/Python/" style="font-size: 15px;">Python</a> <a href="/blog/tags/RecyclerView/" style="font-size: 15px;">RecyclerView</a> <a href="/blog/tags/Gdrive/" style="font-size: 15px;">Gdrive</a> <a href="/blog/tags/ZeroTier/" style="font-size: 15px;">ZeroTier</a> <a href="/blog/tags/Watchdog/" style="font-size: 15px;">Watchdog</a> <a href="/blog/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/blog/tags/Git/" style="font-size: 15px;">Git</a> <a href="/blog/tags/Github/" style="font-size: 15px;">Github</a> <a href="/blog/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/blog/tags/Proxy/" style="font-size: 15px;">Proxy</a> <a href="/blog/tags/Sqlite/" style="font-size: 15px;">Sqlite</a> <a href="/blog/tags/Kotlin/" style="font-size: 15px;">Kotlin</a> <a href="/blog/tags/Tailscale/" style="font-size: 15px;">Tailscale</a> <a href="/blog/tags/weixin/" style="font-size: 15px;">weixin</a> <a href="/blog/tags/Openwrt/" style="font-size: 15px;">Openwrt</a> <a href="/blog/tags/npm/" style="font-size: 15px;">npm</a> <a href="/blog/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/blog/tags/DoH/" style="font-size: 15px;">DoH</a> <a href="/blog/tags/Design-pattern/" style="font-size: 15px;">Design pattern</a> <a href="/blog/tags/Raspberry-Pi/" style="font-size: 15px;">Raspberry Pi</a> <a href="/blog/tags/VLC/" style="font-size: 15px;">VLC</a> <a href="/blog/tags/CRC/" style="font-size: 15px;">CRC</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2024/10/17/hexo-bo-ke-qi-yong-websub/">Hexoåšå®¢å¯ç”¨ WebSub</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/10/16/rang-follow-ren-zheng-wo-de-hexo-bo-ke-ding-yue-yuan/">è®©Followè®¤è¯æˆ‘çš„Hexoåšå®¢è®¢é˜…æº</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/09/10/portainer-chong-zhi-admin-deng-lu-mi-ma/">Portaineré‡ç½®adminç™»å½•å¯†ç </a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/08/02/hua-shuo-lu-you-qi-xiu-gai-hosts/">åç¡•è·¯ç”±å™¨ä¿®æ”¹Hosts</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/30/flutter-shi-yong-intl-generator-zai-windows-xia-bao-cuo-cannot-open-file-path-l10n-arb-intl-arb-os-error-wen-jian-ming-mu-lu-ming-huo-juan-biao-yu-fa-bu-zheng-que/">Flutterä½¿ç”¨intl_generatoråœ¨Windowsä¸‹æŠ¥é”™Cannot open file, path = 'l10n-arb/intl_*.arb' (OS Error: æ–‡ä»¶åã€ç›®å½•åæˆ–å·æ ‡è¯­æ³•ä¸æ­£ç¡®</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/26/zai-hexo-zhong-shi-yong-plantuml/">åœ¨Hexoä¸­ä½¿ç”¨PlantUML</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/26/yong-yu-gou-jian-he-fa-bu-flutter-ying-yong-cheng-xu-de-github-actions-gong-zuo-liu-cheng/">ç”¨äºæ„å»ºå’Œå‘å¸ƒ Flutter åº”ç”¨ç¨‹åºçš„GitHub Actions å·¥ä½œæµç¨‹</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/25/flutter-ge-ge-ping-tai-de-gou-jian-chan-wu/">Flutterå„ä¸ªå¹³å°çš„æ„å»ºäº§ç‰©</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/24/flutter-she-zhi-app-ban-ben/">Flutterè®¾ç½®Appç‰ˆæœ¬</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/15/windows-xia-jin-wei-github-she-zhi-ssh-dai-li/">Windowsä¸‹ä»…ä¸º GitHub è®¾ç½®SSHä»£ç†</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://quincyjiang.github.io/" title="ç˜Ÿç–«é’å¹´" target="_blank">ç˜Ÿç–«é’å¹´</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2024 <a href="/blog/." rel="nofollow">å°éº¦.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/blog/css/search.css?v=1.0.0"><script type="text/javascript" src="/blog/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/blog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.7" zIndex="-1" count="150" src="https://unpkg.com/canvas-nest.js/dist/canvas-nest.js"></script><script type="text/javascript" src="/blog/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/blog/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=1.0.0"></script></div></body></html>