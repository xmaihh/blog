<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>ANRç¨‹åºé—®é¢˜åˆ†æä¹‹traces | å°éº¦</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/blog/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/blog/atom.xml"><script src="https://www.googletagmanager.com/gtag/js?id=G-R3NLYDC8PK" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-R3NLYDC8PK');
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "n85h4t74i7");
</script><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ANRç¨‹åºé—®é¢˜åˆ†æä¹‹traces</h1><a id="logo" href="/blog/.">å°éº¦</a><p class="description">äººç”Ÿçš„å¤§èµ·å¤§è½æ¥å¾—å¤ªçªç„¶ï¼Œæå¾—æˆ‘ç›´æƒ³å°¿å°¿...</p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/blog/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/blog/history/"><i class="fa fa-book"> å†å²</i></a><a href="/blog/about/"><i class="fa fa-user"> å…³äº</i></a><a href="/blog/guestbook/"><i class="fa fa-comments"> ç•™è¨€</i></a><a href="/blog/atom.xml"><i class="fa fa-rss"> è®¢é˜…</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ANRç¨‹åºé—®é¢˜åˆ†æä¹‹traces</h1><div class="post-meta">2018-07-13<span> | </span><span class="category"><a href="/blog/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/">æŠ€æœ¯åˆ†äº«</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 5.3k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 22</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><a class="disqus-comment-count" href="/blog/2018/07/13/anr-cheng-xu-wen-ti-fen-xi-zhi-traces/#vcomment"><span class="valine-comment-count" data-xid="/blog/2018/07/13/anr-cheng-xu-wen-ti-fen-xi-zhi-traces/"></span><span> æ¡è¯„è®º</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">æ–‡ç« ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ANR%E7%9A%84%E5%BC%82%E5%B8%B8%E4%BF%A1%E6%81%AF"><span class="toc-number">1.</span> <span class="toc-text">ANRçš„å¼‚å¸¸ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ANR%E4%BF%A1%E6%81%AF%E6%98%AF%E5%A6%82%E4%BD%95%E8%BE%93%E5%87%BA%E7%9A%84"><span class="toc-number">2.</span> <span class="toc-text">ANRä¿¡æ¯æ˜¯å¦‚ä½•è¾“å‡ºçš„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90ANR%E7%9A%84trace%E4%BF%A1%E6%81%AF"><span class="toc-number">3.</span> <span class="toc-text">åˆ†æANRçš„traceä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81"><span class="toc-number">4.</span> <span class="toc-text">çº¿ç¨‹çŠ¶æ€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-number">5.</span> <span class="toc-text">CPUä½¿ç”¨ç‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CPU%E8%B4%9F%E8%BD%BD-%E5%B9%B3%E5%9D%87%E8%B4%9F%E8%BD%BD"><span class="toc-number">5.1.</span> <span class="toc-text">CPUè´Ÿè½½&#x2F;å¹³å‡è´Ÿè½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ANR%E5%8F%91%E7%94%9F%E4%B9%8B%E5%89%8D%E5%92%8C%E4%B9%8B%E5%90%8E%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E7%9A%84CPU%E4%BD%BF%E7%94%A8%E7%8E%87"><span class="toc-number">5.2.</span> <span class="toc-text">ANRå‘ç”Ÿä¹‹å‰å’Œä¹‹åä¸€æ®µæ—¶é—´çš„CPUä½¿ç”¨ç‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%9E%E7%9D%A1%E7%9C%A0%E6%97%B6%E9%97%B4%E7%99%BE%E5%88%86%E6%AF%94"><span class="toc-number">5.3.</span> <span class="toc-text">éç¡çœ æ—¶é—´ç™¾åˆ†æ¯”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%94%99%E8%AF%AF%E6%AC%A1%E6%95%B0"><span class="toc-number">5.4.</span> <span class="toc-text">é¡µé”™è¯¯æ¬¡æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%92%8C%E7%A7%BB%E9%99%A4%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%88%96%E7%BA%BF%E7%A8%8B"><span class="toc-number">5.5.</span> <span class="toc-text">æ–°å¢å’Œç§»é™¤çš„è¿›ç¨‹æˆ–çº¿ç¨‹</span></a></li></ol></li></ol></div></div><div class="post-content"><p>æ¯æ¬¡å‘ç”ŸANRï¼Œè¿™ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«æ¸…ç©ºï¼Œå†™å…¥æ–°çš„å†…å®¹ã€‚å¦‚æœæƒ³æŸ¥çœ‹ä»¥å‰å‘ç”ŸANRçš„ä¿¡æ¯ï¼Œå¯ä»¥å»æŸ¥çœ‹DBæ–‡ä»¶ï¼Œ<br>ä¹Ÿå°±æ˜¯DropBoxçš„ä¸­çš„æ—¥å¿—<br>è·Ÿè¸ªåŠŸèƒ½ï¼Œä¿å­˜å†å²ä¸Šå‘ç”Ÿçš„æ‰€æœ‰ANRçš„æ—¥å¿—<br>â€œ&#x2F; data &#x2F; system &#x2F; dropboxâ€æ˜¯DBæŒ‡å®šçš„æ–‡ä»¶å­˜æ”¾ä½ç½®ã€‚<br>æ—¥å¿—ä¿å­˜çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤æ˜¯3å¤©</p>
<h3 id="ANRçš„å¼‚å¸¸ä¿¡æ¯"><a href="#ANRçš„å¼‚å¸¸ä¿¡æ¯" class="headerlink" title="ANRçš„å¼‚å¸¸ä¿¡æ¯"></a>ANRçš„å¼‚å¸¸ä¿¡æ¯</h3><p>ä½¿ç”¨logcatå‘½ä»¤æŸ¥çœ‹ä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„log</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WindowManageræ‰€åœ¨çš„è¿›ç¨‹æ˜¯system_serverï¼Œè¿›ç¨‹å·æ˜¯127</span></span><br><span class="line">I/<span class="built_in">WindowManager</span>( <span class="number">127</span>): Input event dispatching timed out sending to com<span class="selector-class">.example</span>.anrdemo/com<span class="selector-class">.example</span><span class="selector-class">.anrdemo</span><span class="selector-class">.ANRActivity</span></span><br><span class="line"><span class="comment">//system_serverè¿›ç¨‹ä¸­çš„ActivityManagerServiceè¯·æ±‚kernelå‘5033è¿›ç¨‹å‘é€SIGNAL_QUITè¯·æ±‚</span></span><br><span class="line"><span class="comment">//ä½ å¯ä»¥åœ¨shellä¸­ä½¿ç”¨å‘½ä»¤è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼šadb shell kill -3 5033</span></span><br><span class="line"><span class="comment">//å’Œå…¶ä»–çš„Javaè™šæ‹Ÿæœºä¸€æ ·ï¼ŒSIGNAL_QUITä¹Ÿæ˜¯Dalvikå†…éƒ¨æ”¯æŒçš„åŠŸèƒ½ä¹‹ä¸€</span></span><br><span class="line">I/Process ( <span class="number">127</span>): Sending signal. PID: <span class="number">5033</span> SIG: <span class="number">3</span></span><br><span class="line"><span class="comment">//5033è¿›ç¨‹çš„è™šæ‹Ÿæœºå®ä¾‹æ¥æ”¶åˆ°SIGNAL_QUITä¿¡å·åä¼šå°†è¿›ç¨‹ä¸­å„ä¸ªçº¿ç¨‹çš„å‡½æ•°å †æ ˆä¿¡æ¯è¾“å‡ºåˆ°traces.txtæ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">//å‘ç”ŸANRçš„è¿›ç¨‹æ­£å¸¸æƒ…å†µä¸‹ä¼šç¬¬ä¸€ä¸ªè¾“å‡º</span></span><br><span class="line">I/<span class="built_in">dalvikvm</span>( <span class="number">5033</span>): threadid=<span class="number">4</span>: reacting to signal <span class="number">3</span></span><br><span class="line">I/<span class="built_in">dalvikvm</span>( <span class="number">5033</span>): Wrote stack traces to <span class="string">&#x27;/data/anr/traces.txt&#x27;</span></span><br><span class="line">... ...<span class="comment">//å¦å¤–è¿˜æœ‰å…¶ä»–ä¸€äº›è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//éšåä¼šè¾“å‡ºCPUä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): ANR <span class="keyword">in</span> com<span class="selector-class">.example</span><span class="selector-class">.anrdemo</span> (com<span class="selector-class">.example</span>.anrdemo/.ANRActivity)</span><br><span class="line"><span class="comment">//Reasonè¡¨ç¤ºå¯¼è‡´ANRé—®é¢˜çš„ç›´æ¥åŸå› </span></span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): Reason: keyDispatchingTimedOut</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): Load: <span class="number">3.85</span> / <span class="number">3.41</span> / <span class="number">3.16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯·æ³¨æ„agoï¼Œè¡¨ç¤ºANRå‘ç”Ÿä¹‹å‰çš„ä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡ï¼Œå¹¶ä¸æ˜¯æŸä¸€æ—¶åˆ»çš„å€¼</span></span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): CPU usage from <span class="number">26835ms</span> to <span class="number">3662ms</span> ago with <span class="number">99%</span> awake:</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">9.4%</span> <span class="number">98</span>/mediaserver: <span class="number">9.4%</span> user + <span class="number">0%</span> kernel</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">8.9%</span> <span class="number">127</span>/system_server: <span class="number">6.9%</span> user + <span class="number">2%</span> kernel / faults: <span class="number">1823</span> minor</span><br><span class="line">... ...</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): +<span class="number">0%</span> <span class="number">5033</span>/com<span class="selector-class">.example</span><span class="selector-class">.anrdemo</span>: <span class="number">0%</span> user + <span class="number">0%</span> kernel</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">39%</span> TOTAL: <span class="number">32%</span> user + <span class="number">6.1%</span> kernel</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œæ˜¯laterï¼Œè¡¨ç¤ºANRå‘ç”Ÿä¹‹å</span></span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): CPU usage from <span class="number">601ms</span> to <span class="number">1132ms</span> later with <span class="number">99%</span> awake:</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">10%</span> <span class="number">127</span>/system_server: <span class="number">1.7%</span> user + <span class="number">8.9%</span> kernel / faults: <span class="number">5</span> minor</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">10%</span> <span class="number">163</span>/InputDispatcher: <span class="number">1.7%</span> user + <span class="number">8.9%</span> kernel</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">1.7%</span> <span class="number">127</span>/system_server: <span class="number">1.7%</span> user + <span class="number">0%</span> kernel</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">1.7%</span> <span class="number">135</span>/SurfaceFlinger: <span class="number">0%</span> user + <span class="number">1.7%</span> kernel</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">1.7%</span> <span class="number">2814</span>/Binder Thread #: <span class="number">1.7%</span> user + <span class="number">0%</span> kernel</span><br><span class="line">... ...</span><br><span class="line">E/<span class="built_in">ActivityManager</span>( <span class="number">127</span>): <span class="number">37%</span> TOTAL: <span class="number">27%</span> user + <span class="number">9.2%</span> kernel</span><br></pre></td></tr></table></figure>
<p>å‘ç”ŸANRæ—¶Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§â€œåˆ©å™¨â€ï¼štracesæ–‡ä»¶å’ŒCPUä½¿ç”¨ç‡</p>
<h3 id="ANRä¿¡æ¯æ˜¯å¦‚ä½•è¾“å‡ºçš„"><a href="#ANRä¿¡æ¯æ˜¯å¦‚ä½•è¾“å‡ºçš„" class="headerlink" title="ANRä¿¡æ¯æ˜¯å¦‚ä½•è¾“å‡ºçš„"></a>ANRä¿¡æ¯æ˜¯å¦‚ä½•è¾“å‡ºçš„</h3><p>ActivityManagerServiceç±»ä¸­ï¼Œæ‰¾åˆ°å®ƒçš„appNotRespondingå‡½æ•°</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">    final <span class="literal">void</span> appNotResponding(ProcessRecord app, ActivityRecord activity,</span><br><span class="line">                                ActivityRecord <span class="keyword">parent</span>, final <span class="built_in">String</span> annotation) &#123;</span><br><span class="line"><span class="comment">//firstPidså’ŒlastPidsä¸¤ä¸ªé›†åˆå­˜æ”¾é‚£äº›å°†ä¼šåœ¨tracesä¸­è¾“å‡ºä¿¡æ¯çš„è¿›ç¨‹çš„è¿›ç¨‹å·</span></span><br><span class="line">        ArrayList&lt;<span class="built_in">Integer</span>&gt; firstPids = <span class="literal">new</span> ArrayList&lt;<span class="built_in">Integer</span>&gt;(<span class="number">5</span>);</span><br><span class="line">        SparseArray&lt;<span class="built_in">Boolean</span>&gt; lastPids = <span class="literal">new</span> SparseArray&lt;<span class="built_in">Boolean</span>&gt;(<span class="number">20</span>);</span><br><span class="line"><span class="comment">//mControlleræ˜¯IActivityControlleræ¥å£çš„å®ä¾‹ï¼Œæ˜¯ä¸ºMonkeyæµ‹è¯•ç¨‹åºé¢„ç•™çš„ï¼Œé»˜è®¤ä¸ºnull</span></span><br><span class="line">        <span class="keyword">if</span> (mController != <span class="built_in">null</span>) &#123;</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">        &#125;</span><br><span class="line">        long anrTime = SystemClock.uptimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (MONITOR_CPU_USAGE) &#123;</span><br><span class="line">            updateCpuStatsNow(); <span class="comment">//æ›´æ–°CPUä½¿ç”¨ç‡</span></span><br><span class="line">        &#125;</span><br><span class="line">        synchronized (this) &#123; <span class="comment">//ä¸€äº›ç‰¹å®šæ¡ä»¶ä¸‹ä¼šå¿½ç•¥ANR</span></span><br><span class="line">            <span class="keyword">if</span> (mShuttingDown) &#123;</span><br><span class="line">                Slog.i(<span class="built_in">TAG</span>, <span class="string">&quot;During shutdown skipping ANR: &quot;</span> + app + <span class="string">&quot; &quot;</span> + annotation);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (app.notResponding) &#123;</span><br><span class="line">                Slog.i(<span class="built_in">TAG</span>, <span class="string">&quot;Skipping duplicate ANR: &quot;</span> + app + <span class="string">&quot; &quot;</span> + annotation);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (app.crashing) &#123;</span><br><span class="line">                Slog.i(<span class="built_in">TAG</span>, <span class="string">&quot;Crashing app skipping ANR: &quot;</span> + app + <span class="string">&quot; &quot;</span> + annotation);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—å˜é‡é¿å…åŒä¸€ä¸ªåº”ç”¨åœ¨æ²¡æœ‰å¤„ç†å®Œæ—¶é‡å¤è¾“å‡ºlog</span></span><br><span class="line">            app.notResponding = <span class="literal">true</span>;</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">         <span class="comment">//â‘ å½“å‰å‘ç”ŸANRçš„åº”ç”¨è¿›ç¨‹è¢«ç¬¬ä¸€ä¸ªæ·»åŠ è¿›firstPidsé›†åˆä¸­</span></span><br><span class="line">            firstPids.add(app.pid);</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">        <span class="comment">//â‘¡dumpStackTracesæ˜¯è¾“å‡ºtracesæ–‡ä»¶çš„å‡½æ•°</span></span><br><span class="line">        File tracesFile = dumpStackTraces(<span class="literal">true</span>, firstPids, processStats, lastPids, <span class="built_in">null</span>);</span><br><span class="line">        <span class="built_in">String</span> cpuInfo = <span class="built_in">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (MONITOR_CPU_USAGE) &#123; <span class="comment">//MONITOR_CPU_USAGEé»˜è®¤ä¸ºtrue</span></span><br><span class="line">            updateCpuStatsNow(); <span class="comment">//å†æ¬¡æ›´æ–°CPUä¿¡æ¯</span></span><br><span class="line">            synchronized (mProcessStatsThread) &#123;</span><br><span class="line">                <span class="comment">//è¾“å‡ºANRå‘ç”Ÿå‰ä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡</span></span><br><span class="line">                cpuInfo = mProcessStats.printCurrentState(anrTime);</span><br><span class="line">            &#125;</span><br><span class="line">            info.append(processStats.printCurrentLoad());</span><br><span class="line">            info.append(cpuInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¾“å‡ºANRå‘ç”Ÿåä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡</span></span><br><span class="line">        info.append(processStats.printCurrentState(anrTime));</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">        <span class="comment">//â‘¢å°†ANRä¿¡æ¯åŒæ—¶è¾“å‡ºåˆ°DropBoxä¸­</span></span><br><span class="line">        addErrorToDropBox(<span class="string">&quot;anr&quot;</span>, app, app.processName, activity, <span class="keyword">parent</span>, annotation,</span><br><span class="line">                cpuInfo, tracesFile, <span class="built_in">null</span>);</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">        <span class="comment">//åœ¨Android4.0ä¸­å¯ä»¥è®¾ç½®æ˜¯å¦ä¸æ˜¾ç¤ºANRæç¤ºå¯¹è¯æ¡†ï¼Œå¦‚æœè®¾ç½®çš„è¯å°±ä¸ä¼šæ˜¾ç¤ºå¯¹è¯æ¡†ï¼Œå¹¶ä¸”ä¼šæ€æ‰ANRè¿›ç¨‹</span></span><br><span class="line">        <span class="built_in">boolean</span> showBackground = Settings.Secure.getInt(mContext.getContentResolver(),</span><br><span class="line">                Settings.Secure.ANR_SHOW_BACKGROUND, <span class="number">0</span>) != <span class="number">0</span>;</span><br><span class="line">        synchronized (this) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!showBackground &amp;&amp; !app.isInterestingToUserLocked() &amp;&amp; app.pid != MY_PID) &#123;</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">                Process.killProcessQuiet(app.pid);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line">            <span class="comment">// æ˜¾ç¤ºANRæç¤ºå¯¹è¯æ¡†</span></span><br><span class="line">            Message msg = Message.obtain();</span><br><span class="line">            HashMap <span class="built_in">map</span> = <span class="literal">new</span> HashMap();</span><br><span class="line">            msg.what = SHOW_NOT_RESPONDING_MSG;</span><br><span class="line">            msg.obj = <span class="built_in">map</span>;</span><br><span class="line">            <span class="built_in">map</span>.put(<span class="string">&quot;app&quot;</span>, app);</span><br><span class="line">            <span class="keyword">if</span> (activity != <span class="built_in">null</span>) &#123;</span><br><span class="line">                <span class="built_in">map</span>.put(<span class="string">&quot;activity&quot;</span>, activity);</span><br><span class="line">            &#125;</span><br><span class="line">            mHandler.sendMessage(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½“å‰å‘ç”ŸANRçš„åº”ç”¨è¿›ç¨‹è¢«ç¬¬ä¸€ä¸ªæ·»åŠ è¿›firstPidsé›†åˆä¸­ï¼Œæ‰€ä»¥ä¼šç¬¬ä¸€ä¸ªå‘tracesæ–‡ä»¶ä¸­å†™å…¥ä¿¡æ¯ã€‚åè¿‡æ¥è¯´ï¼Œtracesæ–‡ä»¶ä¸­å‡ºç°çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹æ­£å¸¸æƒ…å†µä¸‹å°±æ˜¯å‘ç”ŸANRçš„é‚£ä¸ªè¿›ç¨‹ã€‚ä¸è¿‡æœ‰æ—¶å€™ä¼šå¾ˆä¸å‡‘å·§ï¼Œå‘ç”ŸANRçš„è¿›ç¨‹è¿˜æ²¡æœ‰æ¥å¾—åŠè¾“å‡ºtraceä¿¡æ¯ï¼Œå°±ç”±äºæŸç§åŸå› é€€å‡ºäº†ï¼Œæ‰€ä»¥å¶å°”ä¼šé‡åˆ°tracesæ–‡ä»¶ä¸­æ‰¾ä¸åˆ°å‘ç”ŸANRçš„è¿›ç¨‹ä¿¡æ¯çš„æƒ…å†µã€‚<br>dumpStackTracesæ˜¯è¾“å‡ºtracesæ–‡ä»¶çš„å‡½æ•°ï¼Œæ¥ä¸‹æ¥åˆ†æè¿™ä¸ªå‡½æ•°<br>addErrorToDropBoxå‡½æ•°å°†ANRä¿¡æ¯åŒæ—¶è¾“å‡ºåˆ°DropBoxä¸­ï¼Œå®ƒä¹Ÿæ˜¯ä¸ªéå¸¸æœ‰ç”¨çš„æ—¥å¿—å­˜æ”¾å·¥å…·ï¼Œåé¢ä¹Ÿä¼šåˆ†æå®ƒçš„ä½œç”¨ã€‚</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">File</span> dumpStackTraces(<span class="keyword">boolean</span> clearTraces, ArrayList&lt;Integer&gt; firstPids,</span><br><span class="line">                                       ProcessStats processStats, SparseArray&lt;<span class="keyword">Boolean</span>&gt; lastPids, String[] nativeProcs) &#123;</span><br><span class="line"><span class="comment">//ç³»ç»Ÿå±æ€§â€œdalvik.vm.stack-trace-fileâ€ç”¨æ¥é…ç½®traceä¿¡æ¯è¾“å‡ºæ–‡ä»¶</span></span><br><span class="line">        String tracesPath = SystemProperties.get(<span class="string">&quot;dalvik.vm.stack-trace-file&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (tracesPath == <span class="keyword">null</span> || tracesPath.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">File</span> tracesFile = <span class="keyword">new</span> <span class="keyword">File</span>(tracesPath);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">File</span> tracesDir = tracesFile.getParentFile();</span><br><span class="line">            <span class="keyword">if</span> (!tracesDir.exists()) tracesFile.mkdirs();</span><br><span class="line"><span class="comment">//FileUtils.setPermissionsæ˜¯ä¸ªå¾ˆæœ‰ç”¨çš„å‡½æ•°ï¼Œè®¾ç½®æ–‡ä»¶å±æ€§æ—¶ç»å¸¸ä¼šç”¨åˆ°</span></span><br><span class="line">            FileUtils.setPermissions(tracesDir.getPath(), <span class="number">0775</span>, -<span class="number">1</span>, -<span class="number">1</span>); <span class="comment">// drwxrwxr-x</span></span><br><span class="line"><span class="comment">//clearTracesä¸ºtrueï¼Œä¼šåˆ é™¤æ—§æ–‡ä»¶ï¼Œåˆ›å»ºæ–°æ–‡ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (clearTraces &amp;&amp; tracesFile.exists()) tracesFile.<span class="keyword">delete</span>();</span><br><span class="line">            tracesFile.createNewFile();</span><br><span class="line">            FileUtils.setPermissions(tracesFile.getPath(), <span class="number">0666</span>, -<span class="number">1</span>, -<span class="number">1</span>); <span class="comment">// -rw-rw-rw-</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            Slog.w(TAG, <span class="string">&quot;Unable to prepare ANR traces file: &quot;</span> + tracesPath, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//ä¸€ä¸ªé‡è½½å‡½æ•°</span></span><br><span class="line">        dumpStackTraces(tracesPath, firstPids, processStats, lastPids, nativeProcs);</span><br><span class="line">        <span class="keyword">return</span> tracesFile;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹æ‰€ä»¥traceä¿¡æ¯ä¼šè¾“å‡ºåˆ°â€œ&#x2F;data&#x2F;anr&#x2F;traces.txtâ€æ–‡ä»¶ä¸­ï¼Œå°±æ˜¯ç³»ç»Ÿå±æ€§â€œdalvik.vm.stack-trace-fileâ€è®¾ç½®çš„ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨è®¾å¤‡çš„shellä¸­ä½¿ç”¨setpropå’Œgetpropå¯¹ç³»ç»Ÿå±æ€§è¿›è¡Œè®¾ç½®å’Œè¯»å–ï¼š</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getpropdalvik.vm.<span class="keyword">stack</span>-trace-<span class="keyword">file</span></span><br><span class="line">setprop dalvik.vm.<span class="keyword">stack</span>-trace-<span class="keyword">file</span> /tmp/<span class="keyword">stack</span>-traces.txt</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡å‘ç”ŸANRæ—¶éƒ½ä¼šåˆ é™¤æ—§çš„tracesæ–‡ä»¶ï¼Œé‡æ–°åˆ›å»ºæ–°æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´Androidåªä¿ç•™æœ€åä¸€æ¬¡å‘ç”ŸANRæ—¶çš„tracesä¿¡æ¯ï¼Œé‚£ä¹ˆä»¥å‰çš„tracesä¿¡æ¯å°±ä¸¢å¤±äº†ä¹ˆï¼Ÿç¨åå›ç­”ã€‚<br>æ¥ç€æ¥çœ‹é‡è½½çš„dumpStackTraceså‡½æ•°ã€‚</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">private</span> <span class="type">static</span> <span class="type">void</span> <span class="title">dumpStackTraces</span><span class="params">(<span class="type">String</span> tracesPath, ArrayList&lt;Integer&gt; firstPids,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        ProcessStats processStats, SparseArray&lt;Boolean&gt; lastPids, <span class="type">String</span>[] nativeProcs)</span> </span>&#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨FileObserverç›‘å¬åº”ç”¨è¿›ç¨‹æ˜¯å¦å·²ç»å®Œæˆå†™å…¥tracesæ–‡ä»¶çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">//Androidåœ¨åˆ¤æ–­æ¡Œé¢å£çº¸æ–‡ä»¶æ˜¯å¦è®¾ç½®å®Œæˆæ—¶ä¹Ÿæ˜¯ç”¨çš„FileObserverï¼Œå¾ˆæœ‰ç”¨çš„ç±»</span></span><br><span class="line">        FileObserver observer = <span class="keyword">new</span> <span class="built_in">FileObserver</span>(tracesPath, FileObserver.CLOSE_WRITE) &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">void</span> <span class="built_in">onEvent</span>(<span class="type">int</span> event, <span class="type">String</span> path) &#123;</span><br><span class="line">                <span class="built_in">notify</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">... ...</span><br><span class="line"><span class="comment">//é¦–å…ˆè¾“å‡ºfirstPidsé›†åˆä¸­æŒ‡å®šçš„è¿›ç¨‹ï¼Œè¿™äº›ä¹Ÿæ˜¯å¯¹ANRé—®é¢˜æ¥è¯´æœ€é‡è¦çš„è¿›ç¨‹</span></span><br><span class="line">        <span class="keyword">if</span> (firstPids != null) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">int</span> num = firstPids.<span class="built_in">size</span>();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">                    <span class="built_in">synchronized</span> (observer) &#123;</span><br><span class="line"><span class="comment">//å‰é¢æåˆ°çš„SIGNAL_QUIT</span></span><br><span class="line">                        <span class="built_in">Process</span>.<span class="built_in">sendSignal</span>(firstPids.<span class="built_in">get</span>(i), <span class="built_in">Process</span>.SIGNAL_QUIT);</span><br><span class="line">                        observer.<span class="built_in">wait</span>(<span class="number">200</span>);</span><br><span class="line">... ...</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="åˆ†æANRçš„traceä¿¡æ¯"><a href="#åˆ†æANRçš„traceä¿¡æ¯" class="headerlink" title="åˆ†æANRçš„traceä¿¡æ¯"></a>åˆ†æANRçš„traceä¿¡æ¯</h3><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–‡ä»¶ä¸­è¾“å‡ºçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹çš„traceä¿¡æ¯ï¼Œæ­£æ˜¯å‘ç”ŸANRçš„æ¼”ç¤ºç¨‹åº</span></span><br><span class="line"><span class="comment">//å¼€å¤´æ˜¾ç¤ºè¿›ç¨‹å·ã€ANRå‘ç”Ÿçš„æ—¶é—´ç‚¹å’Œè¿›ç¨‹åç§°</span></span><br><span class="line">----- pid <span class="number">9183</span> at <span class="number">2012</span><span class="number">-09</span><span class="number">-28</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">42</span> -----</span><br><span class="line">Cmd line: com.example.anrdemo</span><br><span class="line"> </span><br><span class="line">DALVIK THREADS: <span class="comment">//ä»¥ä¸‹æ˜¯å„ä¸ªçº¿ç¨‹çš„å‡½æ•°å †æ ˆä¿¡æ¯</span></span><br><span class="line"><span class="comment">//mutexesè¡¨ç¤ºè™šæ‹Ÿæœºå®ä¾‹ä¸­å„ç§çº¿ç¨‹ç›¸å…³å¯¹è±¡é”çš„valueå€¼</span></span><br><span class="line">(mutexes: tll=<span class="number">0</span> tsl=<span class="number">0</span> tscl=<span class="number">0</span> ghl=<span class="number">0</span> hwl=<span class="number">0</span> hwll=<span class="number">0</span>)</span><br><span class="line"><span class="comment">//ä¾æ¬¡æ˜¯ï¼šçº¿ç¨‹åã€çº¿ç¨‹ä¼˜å…ˆçº§ã€çº¿ç¨‹åˆ›å»ºæ—¶çš„åºå·ã€â‘ çº¿ç¨‹å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="string">&quot;main&quot;</span> prio=<span class="number">5</span> tid=<span class="number">1</span> TIMED_WAIT</span><br><span class="line"><span class="comment">//ä¾æ¬¡æ˜¯ï¼šçº¿ç¨‹ç»„åç§°ã€suspendCountã€debugSuspendCountã€çº¿ç¨‹çš„Javaå¯¹è±¡åœ°å€ã€çº¿ç¨‹çš„Nativeå¯¹è±¡åœ°å€</span></span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;main&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4025b1b8</span> <span class="built_in">self</span>=<span class="number">0xce68</span></span><br><span class="line"><span class="comment">//sysTidæ˜¯çº¿ç¨‹å·ï¼Œä¸»çº¿ç¨‹çš„çº¿ç¨‹å·å’Œè¿›ç¨‹å·ç›¸åŒ</span></span><br><span class="line">| sysTid=<span class="number">9183</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">-1345002368</span></span><br><span class="line">| schedstat=( <span class="number">140838632</span> <span class="number">210998525</span> <span class="number">213</span> )</span><br><span class="line">at java.lang.VMThread.sleep(Native Method)</span><br><span class="line">at java.lang.<span class="keyword">Thread</span>.sleep(<span class="keyword">Thread</span>.java:<span class="number">1213</span>)</span><br><span class="line">at java.lang.<span class="keyword">Thread</span>.sleep(<span class="keyword">Thread</span>.java:<span class="number">1195</span>)</span><br><span class="line">at com.example.anrdemo.ANRActivity.makeANR(ANRActivity.java:<span class="number">44</span>)</span><br><span class="line">at com.example.anrdemo.ANRActivity.onClick(ANRActivity.java:<span class="number">38</span>)</span><br><span class="line">at android.view.View.performClick(View.java:<span class="number">2486</span>)</span><br><span class="line">at android.view.View$PerformClick.run(View.java:<span class="number">9130</span>)</span><br><span class="line">at android.os.Handler.handleCallback(Handler.java:<span class="number">587</span>)</span><br><span class="line">at android.os.Handler.dispatchMessage(Handler.java:<span class="number">92</span>)</span><br><span class="line">at android.os.Looper.<span class="keyword">loop</span>(Looper.java:<span class="number">130</span>)</span><br><span class="line">at android.app.ActivityThread.main(ActivityThread.java:<span class="number">3703</span>)</span><br><span class="line">at java.lang.reflect.Method.invokeNative(Native Method)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">507</span>)</span><br><span class="line">at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">841</span>)</span><br><span class="line">at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">599</span>)</span><br><span class="line">at dalvik.system.NativeStart.main(Native Method)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//â‘¡Binderçº¿ç¨‹æ˜¯è¿›ç¨‹çš„çº¿ç¨‹æ± ä¸­ç”¨æ¥å¤„ç†binderè¯·æ±‚çš„çº¿ç¨‹</span></span><br><span class="line"><span class="string">&quot;Binder Thread #2&quot;</span> prio=<span class="number">5</span> tid=<span class="number">8</span> NATIVE</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;main&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x40750b90</span> <span class="built_in">self</span>=<span class="number">0x1440b8</span></span><br><span class="line">| sysTid=<span class="number">9190</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">1476256</span></span><br><span class="line">| schedstat=( <span class="number">915528</span> <span class="number">18463135</span> <span class="number">4</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;Binder Thread #1&quot;</span> prio=<span class="number">5</span> tid=<span class="number">7</span> NATIVE</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;main&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4074f848</span> <span class="built_in">self</span>=<span class="number">0x78d40</span></span><br><span class="line">| sysTid=<span class="number">9189</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">1308088</span></span><br><span class="line">| schedstat=( <span class="number">3509523</span> <span class="number">25543212</span> <span class="number">10</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//çº¿ç¨‹åç§°åé¢æ ‡è¯†æœ‰daemonï¼Œè¯´æ˜è¿™æ˜¯ä¸ªå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line"><span class="string">&quot;Compiler&quot;</span> daemon prio=<span class="number">5</span> tid=<span class="number">6</span> VMWAIT</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;system&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4074b928</span> <span class="built_in">self</span>=<span class="number">0x141e78</span></span><br><span class="line">| sysTid=<span class="number">9188</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">1506000</span></span><br><span class="line">| schedstat=( <span class="number">21606438</span> <span class="number">21636964</span> <span class="number">101</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//JDWPçº¿ç¨‹æ˜¯æ”¯æŒè™šæ‹Ÿæœºè°ƒè¯•çš„çº¿ç¨‹ï¼Œä¸éœ€è¦å…³å¿ƒ</span></span><br><span class="line"><span class="string">&quot;JDWP&quot;</span> daemon prio=<span class="number">5</span> tid=<span class="number">5</span> VMWAIT</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;system&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4074b878</span> <span class="built_in">self</span>=<span class="number">0x16c958</span></span><br><span class="line">| sysTid=<span class="number">9187</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">1510224</span></span><br><span class="line">| schedstat=( <span class="number">366211</span> <span class="number">2807617</span> <span class="number">7</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"><span class="comment">//â€œSignal Catcherâ€è´Ÿè´£æ¥æ”¶å’Œå¤„ç†kernelå‘é€çš„å„ç§ä¿¡å·ï¼Œä¾‹å¦‚SIGNAL_QUITã€SIGNAL_USR1ç­‰å°±æ˜¯è¢«è¯¥çº¿ç¨‹</span></span><br><span class="line"><span class="comment">//æ¥æ”¶åˆ°ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å°±æ˜¯ç”±è¯¥çº¿ç¨‹è´Ÿè´£è¾“å‡ºçš„ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„çŠ¶æ€æ˜¯RUNNABLEï¼Œä¸è¿‡æ­¤çº¿ç¨‹ä¹Ÿä¸éœ€è¦å…³å¿ƒ</span></span><br><span class="line"><span class="string">&quot;Signal Catcher&quot;</span> daemon prio=<span class="number">5</span> tid=<span class="number">4</span> RUNNABLE</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;system&quot;</span> sCount=<span class="number">0</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4074b7b8</span> <span class="built_in">self</span>=<span class="number">0x150008</span></span><br><span class="line">| sysTid=<span class="number">9186</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">1501664</span></span><br><span class="line">| schedstat=( <span class="number">1708985</span> <span class="number">6286621</span> <span class="number">9</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;GC&quot;</span> daemon prio=<span class="number">5</span> tid=<span class="number">3</span> VMWAIT</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;system&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4074b710</span> <span class="built_in">self</span>=<span class="number">0x168010</span></span><br><span class="line">| sysTid=<span class="number">9185</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">1503184</span></span><br><span class="line">| schedstat=( <span class="number">305176</span> <span class="number">4821778</span> <span class="number">2</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;HeapWorker&quot;</span> daemon prio=<span class="number">5</span> tid=<span class="number">2</span> VMWAIT</span><br><span class="line">| <span class="keyword">group</span>=<span class="string">&quot;system&quot;</span> sCount=<span class="number">1</span> dsCount=<span class="number">0</span> obj=<span class="number">0x4074b658</span> <span class="built_in">self</span>=<span class="number">0x16a080</span></span><br><span class="line">| sysTid=<span class="number">9184</span> nice=<span class="number">0</span> sched=<span class="number">0</span>/<span class="number">0</span> cgrp=default <span class="keyword">handle</span>=<span class="number">550856</span></span><br><span class="line">| schedstat=( <span class="number">33691407</span> <span class="number">26336669</span> <span class="number">15</span> )</span><br><span class="line">at dalvik.system.NativeStart.run(Native Method)</span><br><span class="line"> </span><br><span class="line">----- end <span class="number">9183</span> -----</span><br><span class="line"> </span><br><span class="line">----- pid <span class="number">127</span> at <span class="number">2012</span><span class="number">-09</span><span class="number">-28</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">42</span> -----</span><br><span class="line">Cmd line: system_server</span><br><span class="line"><span class="params">...</span> <span class="params">...</span></span><br><span class="line"><span class="comment">//çœç•¥å…¶ä»–è¿›ç¨‹çš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<h3 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h3><table>
<thead>
<tr>
<th>Thread.javaä¸­å®šä¹‰çš„çŠ¶æ€</th>
<th>Thread.cppä¸­å®šä¹‰çš„çŠ¶æ€</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>TERMINATED</td>
<td>ZOMBIE</td>
<td>çº¿ç¨‹æ­»äº¡ï¼Œç»ˆæ­¢è¿è¡Œ</td>
</tr>
<tr>
<td>RUNNABLE</td>
<td>RUNNING&#x2F;RUNNABLE</td>
<td>çº¿ç¨‹å¯è¿è¡Œæˆ–æ­£åœ¨è¿è¡Œ</td>
</tr>
<tr>
<td>TIMED_WAITING</td>
<td>TIMED_WAIT</td>
<td>æ‰§è¡Œäº†å¸¦æœ‰è¶…æ—¶å‚æ•°çš„waitã€sleepæˆ–joinå‡½æ•°</td>
</tr>
<tr>
<td>BLOCKED</td>
<td>MONITOR</td>
<td>çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…è·å–å¯¹è±¡é”</td>
</tr>
<tr>
<td>WAITING</td>
<td>WAIT</td>
<td>æ‰§è¡Œäº†æ— è¶…æ—¶å‚æ•°çš„waitå‡½æ•°</td>
</tr>
<tr>
<td>NEW</td>
<td>INITIALIZING</td>
<td>æ–°å»ºï¼Œæ­£åœ¨åˆå§‹åŒ–ï¼Œä¸ºå…¶åˆ†é…èµ„æº</td>
</tr>
<tr>
<td>NEW</td>
<td>STARTING</td>
<td>æ–°å»ºï¼Œæ­£åœ¨å¯åŠ¨</td>
</tr>
<tr>
<td>RUNNABLE</td>
<td>NATIVE</td>
<td>æ­£åœ¨æ‰§è¡ŒJNIæœ¬åœ°å‡½æ•°</td>
</tr>
<tr>
<td>WAITING</td>
<td>VMWAIT</td>
<td>æ­£åœ¨ç­‰å¾…VMèµ„æº</td>
</tr>
<tr>
<td>RUNNABLE</td>
<td>SUSPENDED</td>
<td>çº¿ç¨‹æš‚åœï¼Œé€šå¸¸æ˜¯ç”±äºGCæˆ–debugè¢«æš‚åœ</td>
</tr>
<tr>
<td></td>
<td>UNKNOWN</td>
<td>æœªçŸ¥çŠ¶æ€</td>
</tr>
<tr>
<td>Thread.javaä¸­çš„çŠ¶æ€å’ŒThread.cppä¸­çš„çŠ¶æ€æ˜¯æœ‰å¯¹åº”å…³ç³»çš„ã€‚å¯ä»¥çœ‹åˆ°å‰è€…æ›´åŠ æ¦‚æ‹¬ï¼Œä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œé¢å‘Javaçš„ä½¿ç”¨è€…ï¼›è€Œåè€…æ›´è¯¦ç»†ï¼Œé¢å‘è™šæ‹Ÿæœºå†…éƒ¨çš„ç¯å¢ƒã€‚traces.txtä¸­æ˜¾ç¤ºçš„çº¿ç¨‹çŠ¶æ€éƒ½æ˜¯Thread.cppä¸­å®šä¹‰çš„ã€‚å¦å¤–ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯éµå¾ªPOSIXæ ‡å‡†çš„æœ¬åœ°çº¿ç¨‹ã€‚å…³äºçº¿ç¨‹æ›´å¤šçš„è¯´æ˜å¯ä»¥æŸ¥é˜…æºç &#x2F;dalvik&#x2F;vm&#x2F;Thread.cppä¸­çš„è¯´æ˜ã€‚<!-- çº¿ç¨‹çš„ThreadGroupæœ€å¥½ä¹Ÿå†™è¿›å» --></td>
<td></td>
<td></td>
</tr>
<tr>
<td>traces.txtæ–‡ä»¶ä¸­çš„è¿™äº›ä¿¡æ¯æ˜¯ç”±æ¯ä¸ªDalvikè¿›ç¨‹çš„SignalCatcherçº¿ç¨‹è¾“å‡ºçš„ï¼Œç›¸å…³ä»£ç å¯ä»¥æŸ¥çœ‹&#x2F;dalvik&#x2F;vm&#x2F;ç›®å½•ä¸‹çš„SignalCatcher.cpp::logThreadStackså‡½æ•°å’ŒThread.cpp:: dvmDumpAllThreadsExå‡½æ•°ã€‚å¦å¤–è¯·æ³¨æ„ï¼Œè¾“å‡ºå †æ ˆä¿¡æ¯æ—¶SignalCatcherä¼šæš‚åœæ‰€æœ‰çº¿ç¨‹ã€‚</td>
<td></td>
<td></td>
</tr>
<tr>
<td>é€šè¿‡è¯¥æ–‡ä»¶å¾ˆå®¹æ˜“å°±èƒ½çŸ¥é“é—®é¢˜è¿›ç¨‹çš„ä¸»çº¿ç¨‹å‘ç”ŸANRæ—¶æ­£åœ¨æ‰§è¡Œæ€æ ·çš„æ“ä½œã€‚ä¾‹å¦‚ä¸Šè¿°ç¤ºä¾‹ï¼Œ ANRActivityåœ¨makeANRå‡½æ•°ä¸­æ‰§è¡Œçº¿ç¨‹sleepæ—¶å‘ç”ŸANRï¼Œå¯ä»¥æ¨æµ‹sleepæ—¶é—´è¿‡é•¿ï¼Œè¶…è¿‡äº†è¶…æ—¶ä¸Šé™å¯¼è‡´ã€‚</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="CPUä½¿ç”¨ç‡"><a href="#CPUä½¿ç”¨ç‡" class="headerlink" title="CPUä½¿ç”¨ç‡"></a>CPUä½¿ç”¨ç‡</h3><p>å†…å®¹è¯»å–è‡ª&#x2F;proc&#x2F;stat</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="string">ANR</span> <span class="string">in</span> <span class="string">com.example.anrdemo</span> <span class="string">(com.example.anrdemo/.ANRActivity)</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127): Reason:</span> <span class="string">keyDispatchingTimedOut</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127): Load:</span> <span class="number">3.85</span> <span class="string">/</span> <span class="number">3.41</span> <span class="string">/</span> <span class="number">3.16</span> <span class="string">//â€</span> <span class="string">CPUå¹³å‡è´Ÿè½½</span></span><br><span class="line"> </span><br><span class="line"><span class="string">//â‘¡ANRå‘ç”Ÿä¹‹å‰çš„ä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="string">CPU</span> <span class="string">usage</span> <span class="string">from</span> <span class="string">26835ms</span> <span class="string">to</span> <span class="string">3662ms</span> <span class="string">ago</span> <span class="string">with</span> <span class="number">99</span><span class="string">%</span> <span class="string">awake://â‘¢</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">9.4</span><span class="string">%</span> <span class="attr">98/mediaserver:</span> <span class="number">9.4</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">0</span><span class="string">%</span> <span class="string">kernel</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">8.9</span><span class="string">%</span> <span class="attr">127/system_server:</span> <span class="number">6.9</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">2</span><span class="string">%</span> <span class="attr">kernel / faults:</span> <span class="number">1823 </span><span class="string">minor</span> <span class="string">//â‘¤</span> <span class="string">minoræˆ–è€…majorçš„é¡µé”™è¯¯æ¬¡æ•°</span></span><br><span class="line"><span class="string">...</span> <span class="string">...</span></span><br><span class="line"><span class="string">E/ActivityManager(</span> <span class="number">127</span><span class="string">)://â‘¥+0%</span> <span class="attr">5033/com.example.anrdemo:</span> <span class="number">0</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">0</span><span class="string">%</span> <span class="string">kernel</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">39</span><span class="string">%</span> <span class="attr">TOTAL:</span> <span class="number">32</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">6.1</span><span class="string">%</span> <span class="string">kernel</span></span><br><span class="line"> </span><br><span class="line"><span class="string">//â‘¦ANRå‘ç”Ÿä¹‹åçš„ä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="string">CPU</span> <span class="string">usage</span> <span class="string">from</span> <span class="string">601ms</span> <span class="string">to</span> <span class="string">1132ms</span> <span class="string">later</span> <span class="string">with</span> <span class="number">99</span><span class="string">%</span> <span class="attr">awake:</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">10</span><span class="string">%</span> <span class="attr">127/system_server:</span> <span class="number">1.7</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">8.9</span><span class="string">%</span> <span class="attr">kernel / faults:</span> <span class="number">5</span> <span class="string">minor</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">10</span><span class="string">%</span> <span class="attr">163/InputDispatcher:</span> <span class="number">1.7</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">8.9</span><span class="string">%</span> <span class="string">kernel</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">1.7</span><span class="string">%</span> <span class="attr">127/system_server:</span> <span class="number">1.7</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">0</span><span class="string">%</span> <span class="string">kernel</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">1.7</span><span class="string">%</span> <span class="attr">135/SurfaceFlinger:</span> <span class="number">0</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">1.7</span><span class="string">%</span> <span class="string">kernel</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">1.7</span><span class="string">%</span> <span class="number">2814</span><span class="string">/Binder</span> <span class="string">Thread</span> <span class="comment">#: 1.7% user + 0% kernel</span></span><br><span class="line"><span class="string">...</span> <span class="string">...</span></span><br><span class="line"><span class="attr">E/ActivityManager( 127):</span> <span class="number">37</span><span class="string">%</span> <span class="attr">TOTAL:</span> <span class="number">27</span><span class="string">%</span> <span class="string">user</span> <span class="string">+</span> <span class="number">9.2</span><span class="string">%</span> <span class="string">kernel</span></span><br></pre></td></tr></table></figure>
<h4 id="CPUè´Ÿè½½-å¹³å‡è´Ÿè½½"><a href="#CPUè´Ÿè½½-å¹³å‡è´Ÿè½½" class="headerlink" title="CPUè´Ÿè½½&#x2F;å¹³å‡è´Ÿè½½"></a>CPUè´Ÿè½½&#x2F;å¹³å‡è´Ÿè½½</h4><p>CPUè´Ÿè½½æ˜¯æŒ‡æŸä¸€æ—¶åˆ»ç³»ç»Ÿä¸­è¿è¡Œé˜Ÿåˆ—é•¿åº¦ä¹‹å’ŒåŠ ä¸Šå½“å‰æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹æ•°ï¼Œè€ŒCPUå¹³å‡è´Ÿè½½å¯ä»¥ç†è§£ä¸ºä¸€æ®µæ—¶é—´å†…æ­£åœ¨ä½¿ç”¨å’Œç­‰å¾…ä½¿ç”¨CPUçš„æ´»åŠ¨è¿›ç¨‹çš„å¹³å‡æ•°é‡ã€‚åœ¨Linuxä¸­â€œæ´»åŠ¨è¿›ç¨‹â€æ˜¯æŒ‡å½“å‰çŠ¶æ€ä¸ºè¿è¡Œæˆ–ä¸å¯ä¸­æ–­é˜»å¡çš„è¿›ç¨‹ã€‚é€šå¸¸æ‰€è¯´çš„è´Ÿè½½å…¶å®å°±æ˜¯æŒ‡å¹³å‡è´Ÿè½½ã€‚<br>ç”¨ä¸€ä¸ªä»ç½‘ä¸Šçœ‹åˆ°çš„å¾ˆç”ŸåŠ¨çš„ä¾‹å­æ¥è¯´æ˜ï¼ˆä¸è€ƒè™‘CPUæ—¶é—´ç‰‡çš„é™åˆ¶ï¼‰ï¼ŒæŠŠè®¾å¤‡ä¸­çš„ä¸€ä¸ªå•æ ¸CPUæ¯”ä½œä¸€ä¸ªç”µè¯äº­ï¼ŒæŠŠè¿›ç¨‹æ¯”ä½œæ­£åœ¨ä½¿ç”¨å’Œç­‰å¾…ä½¿ç”¨ç”µè¯çš„äººï¼Œå‡å¦‚æœ‰ä¸€ä¸ªäººæ­£åœ¨æ‰“ç”µè¯ï¼Œæœ‰ä¸‰ä¸ªäººåœ¨æ’é˜Ÿç­‰å¾…ï¼Œæ­¤åˆ»ç”µè¯äº­çš„è´Ÿè½½å°±æ˜¯4ã€‚ä½¿ç”¨ä¸­ä¼šä¸æ–­çš„æœ‰äººæ‰“å®Œç”µè¯ç¦»å¼€ï¼Œä¹Ÿä¼šä¸æ–­çš„æœ‰å…¶ä»–äººæ’é˜Ÿç­‰å¾…ï¼Œä¸ºäº†å¾—åˆ°ä¸€ä¸ªæœ‰å‚è€ƒä»·å€¼çš„è´Ÿè½½å€¼ï¼Œå¯ä»¥è§„å®šæ¯éš”5ç§’è®°å½•ä¸€ä¸‹ç”µè¯äº­çš„è´Ÿè½½ï¼Œå¹¶å°†æŸä¸€æ—¶åˆ»ä¹‹å‰çš„ä¸€åˆ†é’Ÿã€äº”åˆ†é’Ÿã€åäº”åˆ†é’Ÿçš„çš„è´Ÿè½½æƒ…å†µåˆ†åˆ«æ±‚å¹³å‡å€¼ï¼Œæœ€ç»ˆå°±å¾—åˆ°äº†ä¸‰ä¸ªæ—¶æ®µçš„å¹³å‡è´Ÿè½½ã€‚<br>å®é™…ä¸Šæˆ‘ä»¬é€šå¸¸å…³å¿ƒçš„å°±æ˜¯åœ¨æŸä¸€æ—¶åˆ»çš„å‰ä¸€åˆ†é’Ÿã€äº”åˆ†é’Ÿã€åäº”åˆ†é’Ÿçš„CPUå¹³å‡è´Ÿè½½ï¼Œä¾‹å¦‚ä»¥ä¸Šæ—¥å¿—ä¸­è¿™ä¸‰ä¸ªå€¼åˆ†åˆ«æ˜¯3.85ã€3.41ã€3.16ï¼Œè¯´æ˜å‰ä¸€åˆ†é’Ÿå†…æ­£åœ¨ä½¿ç”¨å’Œç­‰å¾…ä½¿ç”¨CPUçš„æ´»åŠ¨è¿›ç¨‹å¹³å‡æœ‰3.85ä¸ªï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨å¤§å‹æœåŠ¡å™¨ç«¯åº”ç”¨ä¸­ä¸»è¦å…³æ³¨çš„æ˜¯ç¬¬äº”åˆ†é’Ÿå’Œç¬¬åäº”åˆ†é’Ÿçš„ä¸¤ä¸ªå€¼ï¼Œä½†æ˜¯Androidä¸»è¦åº”ç”¨åœ¨ä¾¿æºæ‰‹æŒè®¾å¤‡ä¸­ï¼Œæœ‰ç‰¹æ®Šçš„è½¯ç¡¬ä»¶ç¯å¢ƒå’Œåº”ç”¨åœºæ™¯ï¼ŒçŸ­æ—¶é—´å†…çš„ç³»ç»Ÿçš„è¾ƒé«˜è´Ÿè½½å°±æœ‰å¯èƒ½é€ æˆANRï¼Œæ‰€ä»¥ç¬”è€…è®¤ä¸ºä¸€åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½ç›¸å¯¹æ¥è¯´æ›´å…·æœ‰å‚è€ƒä»·å€¼ã€‚<br>CPUçš„è´Ÿè½½å’Œä½¿ç”¨ç‡æ²¡æœ‰å¿…ç„¶å…³ç³»ï¼Œæœ‰å¯èƒ½åªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨CPUï¼Œä½†æ‰§è¡Œçš„æ˜¯å¤æ‚çš„æ“ä½œï¼›ä¹Ÿæœ‰å¯èƒ½ç­‰å¾…å’Œæ­£åœ¨ä½¿ç”¨CPUçš„è¿›ç¨‹å¾ˆå¤šï¼Œä½†æ¯ä¸ªè¿›ç¨‹æ‰§è¡Œçš„éƒ½æ˜¯ç®€å•æ“ä½œã€‚<br>å®é™…å¤„ç†é—®é¢˜æ—¶å¶å°”ä¼šé‡åˆ°ç”±äºå¹³å‡è´Ÿè½½é«˜å¼•èµ·çš„ANRï¼Œå…¸å‹çš„ç‰¹å¾å°±æ˜¯ç³»ç»Ÿä¸­åº”ç”¨è¿›ç¨‹æ•°é‡å¤šï¼ŒCPUæ€»ä½¿ç”¨ç‡è¾ƒé«˜ï¼Œä½†æ˜¯æ¯ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ä¸é«˜ï¼Œå½“å‰åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹æ²¡æœ‰å¼‚å¸¸é˜»å¡ï¼Œä¸€åˆ†é’Ÿå†…çš„CPUå¹³å‡è´Ÿè½½è¾ƒé«˜ã€‚</p>
<blockquote>
<p>æç¤ºï¼šLinuxå†…æ ¸ä¸æ–­è¿›è¡Œç€CPUè´Ÿè½½çš„è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„æ—¶åˆ»é€šè¿‡åœ¨shellä¸­æ‰§è¡Œâ€œcat &#x2F;proc&#x2F;loadavgâ€æŸ¥çœ‹ã€‚</p>
</blockquote>
<h4 id="ANRå‘ç”Ÿä¹‹å‰å’Œä¹‹åä¸€æ®µæ—¶é—´çš„CPUä½¿ç”¨ç‡"><a href="#ANRå‘ç”Ÿä¹‹å‰å’Œä¹‹åä¸€æ®µæ—¶é—´çš„CPUä½¿ç”¨ç‡" class="headerlink" title="ANRå‘ç”Ÿä¹‹å‰å’Œä¹‹åä¸€æ®µæ—¶é—´çš„CPUä½¿ç”¨ç‡"></a>ANRå‘ç”Ÿä¹‹å‰å’Œä¹‹åä¸€æ®µæ—¶é—´çš„CPUä½¿ç”¨ç‡</h4><p>CPUä½¿ç”¨ç‡å¯ä»¥ç†è§£ä¸ºä¸€æ®µæ—¶é—´ï¼ˆè®°ä½œTï¼‰å†…é™¤CPUç©ºé—²æ—¶é—´ï¼ˆè®°ä½œIï¼‰ä¹‹å¤–çš„æ—¶é—´ä¸è¿™æ®µæ—¶é—´Tçš„æ¯”å€¼ï¼Œç”¨å…¬å¼è¡¨ç¤ºå¯ä»¥å†™ä¸ºï¼š</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CPUä½¿ç”¨ç‡= (<span class="built_in">T</span> â€“ I) / <span class="built_in">T</span></span><br></pre></td></tr></table></figure>
<p>è€Œæ—¶é—´æ®µTæ˜¯ä¸¤ä¸ªé‡‡æ ·æ—¶é—´ç‚¹çš„æ—¶é—´å·®å€¼ã€‚<br>ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·è®¡ç®—ï¼Œæ˜¯å› ä¸ºLinuxå†…æ ¸ä¼šæŠŠä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹åˆ°å½“å‰æ—¶åˆ»CPUæ´»åŠ¨çš„æ‰€æœ‰æ—¶é—´ä¿¡æ¯éƒ½è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹â€œ&#x2F;proc&#x2F;statâ€æ–‡ä»¶è·å–è¿™äº›ä¿¡æ¯ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ—¶é—´ï¼Œè¿™äº›æ—¶é—´éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹è®¡ç®—çš„ï¼Œå•ä½éƒ½æ˜¯0.01ç§’ï¼š</p>
<ul>
<li>userï¼š CPUåœ¨ç”¨æˆ·æ€çš„è¿è¡Œæ—¶é—´ï¼Œä¸åŒ…æ‹¬niceå€¼ä¸ºè´Ÿæ•°çš„è¿›ç¨‹è¿è¡Œçš„æ—¶é—´</li>
<li>niceï¼š CPUåœ¨ç”¨æˆ·æ€å¹¶ä¸”niceå€¼ä¸ºè´Ÿæ•°çš„è¿›ç¨‹è¿è¡Œçš„æ—¶é—´</li>
<li>systemï¼šCPUåœ¨å†…æ ¸æ€è¿è¡Œçš„æ—¶é—´</li>
<li>idleï¼š CPUç©ºé—²æ—¶é—´ï¼Œä¸åŒ…æ‹¬iowaitæ—¶é—´</li>
<li>iowaitï¼š CPUç­‰å¾…I&#x2F;Oæ“ä½œçš„æ—¶é—´</li>
<li>irqï¼š CPUç¡¬ä¸­æ–­çš„æ—¶é—´</li>
<li>softirqï¼šCPUè½¯ä¸­æ–­çš„æ—¶é—´</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šéšç€Linuxå†…æ ¸ç‰ˆæœ¬çš„ä¸åŒï¼ŒåŒ…å«çš„æ—¶é—´ç±»å‹æœ‰å¯èƒ½ä¸åŒ,Androidæºç åªéœ€è¦å…³å¿ƒä»¥ä¸Šä¸ƒç§ç±»å‹å³å¯</p>
</blockquote>
<p>CPUä½¿ç”¨ç‡çš„è®¡ç®—æ˜¯åœ¨ProcessStatsç±»ä¸­å®ç°çš„ã€‚å¦‚æœåœ¨æŸä¸¤ä¸ªæ—¶åˆ»T1å’ŒT2ï¼ˆT1 &lt; T2ï¼‰è¿›è¡Œé‡‡æ ·è®°å½•ï¼ŒCPUä½¿ç”¨ç‡çš„æ•´ä¸ªç®—æ³•å¯ä»¥å½’çº³ä¸ºä»¥ä¸‹å‡ ä¸ªå…¬å¼ï¼š</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userTime</span> = (user2 + nice2) â€“ (user1 + nice1)</span><br><span class="line"><span class="attr">systemTime</span> = system2 - system1</span><br><span class="line"><span class="attr">idleTime</span> = idle2 - idle1</span><br><span class="line"><span class="attr">iowaitTime</span> = iowait2 - iowait1</span><br><span class="line"><span class="attr">irqTime</span> = irq2 - irq1</span><br><span class="line"><span class="attr">softirqTime</span> = softirq2 - softirq1</span><br><span class="line"><span class="attr">TotalTime</span> = userTime + systemTime + idleTime + iowaitTime + irqTime + softirqTime</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†ä»¥ä¸Šæ•°æ®å°±å¯ä»¥è®¡ç®—å…·ä½“çš„ä½¿ç”¨ç‡äº†ï¼Œä¾‹å¦‚ç”¨æˆ·æ€CPUä½¿ç”¨ç‡ä¸ºï¼š<br><code>userCpuUsage = userTime / TotalTime</code><br>ä¾æ­¤ç±»æ¨å¯ä»¥è®¡ç®—å…¶ä»–ç±»å‹çš„ä½¿ç”¨ç‡ã€‚è€Œæ•´ä¸ªæ—¶é—´æ®µå†…CPUä½¿ç”¨ç‡ä¸ºï¼š<br><code>CpuUsage = (TotalTime â€“ idleTime) / TotalTime</code><br>ä»¥ä¸Šè®¡ç®—çš„æ˜¯æ•´ä¸ªç³»ç»Ÿçš„CPUä½¿ç”¨ç‡ï¼Œå¯¹äºæŒ‡å®šè¿›ç¨‹çš„ä½¿ç”¨ç‡æ˜¯é€šè¿‡è¯»å–è¯¥è¿›ç¨‹çš„â€œ&#x2F;proc&#x2F;è¿›ç¨‹å·&#x2F;statâ€æ–‡ä»¶è®¡ç®—çš„ï¼Œè€Œå¯¹äºæŒ‡å®šè¿›ç¨‹çš„æŒ‡å®šçº¿ç¨‹çš„ä½¿ç”¨ç‡æ˜¯é€šè¿‡è¯»å–è¯¥çº¿ç¨‹çš„â€œ&#x2F;proc&#x2F;è¿›ç¨‹å·&#x2F;task&#x2F;çº¿ç¨‹å·&#x2F;statâ€æ–‡ä»¶è®¡ç®—çš„ã€‚è¿›ç¨‹å’Œçº¿ç¨‹çš„CPUä½¿ç”¨ç‡åªåŒ…å«è¯¥è¿›ç¨‹æˆ–çº¿ç¨‹çš„æ€»ä½¿ç”¨ç‡ã€ç”¨æˆ·æ€ä½¿ç”¨ç‡å’Œå†…æ ¸æ€ä½¿ç”¨ç‡ã€‚<br>AMSåœ¨æ‰§è¡ŒappNotRespondingå‡½æ•°è¿‡ç¨‹ä¸­ï¼Œå…±è¾“å‡ºäº†ä¸¤ä¸ªæ—¶é—´æ®µçš„CPUä½¿ç”¨ç‡ï¼Œé€šå¸¸æƒ…å†µä¸‹åœ¨ANRå‘ç”Ÿæ—¶é—´ç‚¹ä¹‹å‰å’Œä¹‹åå„æœ‰ä¸€æ®µã€‚ä¸¤æ®µä½¿ç”¨ç‡éƒ½æ˜¯ä¸¤æ¬¡è°ƒç”¨ProcessStatså¯¹è±¡çš„updateå‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨updateå‡½æ•°æ—¶ä¼šä¿ç•™ä¸Šä¸€æ—¶é—´ç‚¹çš„é‡‡æ ·æ•°æ®ï¼Œå¹¶è®°å½•å½“å‰æ—¶é—´ç‚¹çš„é‡‡æ ·æ•°æ®ã€‚ç„¶åå†è°ƒç”¨ProcessStatså¯¹è±¡çš„printCurrentStateå‡½æ•°<br>ä»£ç ä½ç½®ActivityManagerService.java â†’ appNotResponding</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬ä¸€æ¬¡ä½¿ç”¨æˆå‘˜å˜é‡mProcessStatsé‡‡æ ·</span></span><br><span class="line"><span class="keyword">if</span>(MONITOR_CPU_USAGE)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        updateCpuStatsNow();</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line">    <span class="comment">//å£°æ˜äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå‚æ•°trueè¡¨ç¤ºåŒ…æ‹¬çº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">final</span> ProcessStats processStats = <span class="keyword">new</span> ProcessStats(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//å°†processStatsä½œä¸ºå®å‚ä¼ å…¥ï¼Œåœ¨dumpStackTracesä¸­ç›¸éš”500æ¯«ç§’ä¸¤æ¬¡è°ƒç”¨å…¶updateå‡½æ•°è¿›è¡Œé‡‡æ ·</span></span><br><span class="line">    <span class="keyword">File</span> tracesFile = dumpStackTraces(<span class="keyword">true</span>, firstPids, processStats, lastPids);</span><br><span class="line">    String cpuInfo = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(MONITOR_CPU_USAGE)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨åï¼Œå¯èƒ½ç”±äºè¾“å‡ºtraceä¿¡æ¯ç­‰æ“ä½œï¼Œä¸­é—´æ‰§è¡Œäº†è¾ƒé•¿çš„æ—¶é—´ï¼Œæ‰€ä»¥æœ‰ç¬¬äºŒæ¬¡ä½¿ç”¨æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="comment">//mProcessStatsé‡‡æ ·ï¼Œå°½é‡ä½¿å¾—é‡‡æ ·æ—¶é—´ç‚¹é åã€‚</span></span><br><span class="line"><span class="comment">//æ­¤å‡½æ•°ä¸­è¦æ±‚è¿ç»­ä¸¤æ¬¡é‡‡æ ·æ—¶é—´é—´éš”ä¸å°‘äº5ç§’ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šæ‰§è¡Œç¬¬äºŒæ¬¡é‡‡æ ·ã€‚ä¸€æ—¦æ‰§è¡Œï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªé‡‡æ ·</span></span><br><span class="line"><span class="comment">//æ—¶é—´ç‚¹ä¸€ä¸ªåœ¨ANRå‘ç”Ÿä¹‹å‰ï¼Œå¦ä¸€ä¸ªåœ¨å…¶ä¹‹åï¼Œæˆ–è€…ä¸¤ä¸ªæ—¶é—´ç‚¹éƒ½åœ¨ANRå‘ç”Ÿä¹‹åçš„æƒ…å†µã€‚</span></span><br><span class="line">        updateCpuStatsNow();</span><br><span class="line">        <span class="keyword">synchronized</span> (mProcessStatsThread) &#123;</span><br><span class="line"><span class="comment">//mProcessStatsæ˜¯æˆå‘˜å˜é‡ï¼Œåˆ›å»ºå¯¹è±¡æ—¶ä¼ å…¥çš„å‚æ•°æ˜¯falseï¼Œæ‰€ä»¥ä¸åŒ…æ‹¬çº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//æ­¤å¤„å…ˆè¾“å‡ºANRå‘ç”Ÿä¹‹å‰ä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡</span></span><br><span class="line">            cpuInfo = mProcessStats.printCurrentState(anrTime);</span><br><span class="line">        &#125;</span><br><span class="line">        info.<span class="keyword">append</span>(processStats.printCurrentLoad());</span><br><span class="line">        info.<span class="keyword">append</span>(cpuInfo);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//processStatså¯¹è±¡æ˜¯åœ¨ANRå‘ç”Ÿååˆ›å»ºå¹¶é‡‡æ ·çš„ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ˜¯ANRå‘ç”Ÿä¹‹åä¸€æ®µæ—¶é—´å†…çš„CPUä½¿ç”¨ç‡</span></span><br><span class="line">info.<span class="keyword">append</span>(processStats.printCurrentState(anrTime));</span><br></pre></td></tr></table></figure>
<h4 id="éç¡çœ æ—¶é—´ç™¾åˆ†æ¯”"><a href="#éç¡çœ æ—¶é—´ç™¾åˆ†æ¯”" class="headerlink" title="éç¡çœ æ—¶é—´ç™¾åˆ†æ¯”"></a>éç¡çœ æ—¶é—´ç™¾åˆ†æ¯”</h4><p>åœ¨è®°å½•CPUä½¿ç”¨ç‡çš„æ¯ä¸ªé‡‡æ ·æ—¶é—´ç‚¹æ—¶ä½¿ç”¨äº†ä¸¤ç§è®°å½•æ–¹æ³•ï¼šSystemClock.uptimeMillis()å’ŒSystemClock.elapsedRealtime()ï¼Œä¸¤è€…çš„åŒºåˆ«å°±æ˜¯uptimeMillisä¸åŒ…å«ç¡çœ æ—¶é—´ï¼Œæ‰€ä»¥ä¸¤ä¸ªé‡‡æ ·æ—¶é—´ç‚¹ä¹‹é—´çš„uptimeMilliså’ŒelapsedRealtimeä¹‹æ¯”å°±æ˜¯éç¡çœ æ—¶é—´ç™¾åˆ†æ¯”ã€‚</p>
<h4 id="é¡µé”™è¯¯æ¬¡æ•°"><a href="#é¡µé”™è¯¯æ¬¡æ•°" class="headerlink" title="é¡µé”™è¯¯æ¬¡æ•°"></a>é¡µé”™è¯¯æ¬¡æ•°</h4><p>è¿›ç¨‹çš„CPUä½¿ç”¨ç‡æœ€åè¾“å‡ºçš„â€œfaults: xxx minor&#x2F;majorâ€éƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯é¡µé”™è¯¯æ¬¡æ•°ï¼Œå½“æ¬¡æ•°ä¸º0æ—¶ä¸æ˜¾ç¤ºã€‚majoræ˜¯æŒ‡Major Page Faultï¼ˆä¸»è¦é¡µé”™è¯¯ï¼Œç®€ç§°MPFï¼‰ï¼Œå†…æ ¸åœ¨è¯»å–æ•°æ®æ—¶ä¼šå…ˆåæŸ¥æ‰¾CPUçš„é«˜é€Ÿç¼“å­˜å’Œç‰©ç†å†…å­˜ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¼šå‘å‡ºä¸€ä¸ªMPFä¿¡æ¯ï¼Œè¯·æ±‚å°†æ•°æ®åŠ è½½åˆ°å†…å­˜ã€‚Minoræ˜¯æŒ‡Minor Page Faultï¼ˆæ¬¡è¦é¡µé”™è¯¯ï¼Œç®€ç§°MnPFï¼‰ï¼Œç£ç›˜æ•°æ®è¢«åŠ è½½åˆ°å†…å­˜åï¼Œå†…æ ¸å†æ¬¡è¯»å–æ—¶ï¼Œä¼šå‘å‡ºä¸€ä¸ªMnPFä¿¡æ¯ã€‚ä¸€ä¸ªæ–‡ä»¶ç¬¬ä¸€æ¬¡è¢«è¯»å†™æ—¶ä¼šæœ‰å¾ˆå¤šçš„MPFï¼Œè¢«ç¼“å­˜åˆ°å†…å­˜åå†æ¬¡è®¿é—®MPFå°±ä¼šå¾ˆå°‘ï¼ŒMnPFåè€Œå˜å¤šï¼Œè¿™æ˜¯å†…æ ¸ä¸ºå‡å°‘æ•ˆç‡ä½ä¸‹çš„ç£ç›˜I&#x2F;Oæ“ä½œé‡‡ç”¨çš„ç¼“å­˜æŠ€æœ¯çš„ç»“æœã€‚</p>
<p>å¦‚æœANRå‘ç”Ÿæ—¶å‘ç°CPUä½¿ç”¨ç‡ä¸­iowaitå æ¯”å¾ˆé«˜ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹è¿›ç¨‹çš„majoræ¬¡æ•°æ¥æ¨æ–­æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨è¿›è¡Œç£ç›˜I&#x2F;Oæ“ä½œã€‚<!-- æ±‚è¯ä¸€ä¸‹ --></p>
<h4 id="æ–°å¢å’Œç§»é™¤çš„è¿›ç¨‹æˆ–çº¿ç¨‹"><a href="#æ–°å¢å’Œç§»é™¤çš„è¿›ç¨‹æˆ–çº¿ç¨‹" class="headerlink" title="æ–°å¢å’Œç§»é™¤çš„è¿›ç¨‹æˆ–çº¿ç¨‹"></a>æ–°å¢å’Œç§»é™¤çš„è¿›ç¨‹æˆ–çº¿ç¨‹</h4><p>å¦‚æœä¸€ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹çš„CPUä½¿ç”¨ç‡å‰æœ‰â€œ+â€ï¼Œè¯´æ˜è¯¥è¿›ç¨‹æˆ–çº¿ç¨‹æ˜¯åœ¨æœ€åä¸¤æ¬¡CPUä½¿ç”¨ç‡é‡‡æ ·æ—¶é—´æ®µå†…æ–°å»ºçš„ï¼›åä¹‹å¦‚æœæ˜¯â€œ-â€ï¼Œè¯´æ˜è¯¥è¿›ç¨‹æˆ–çº¿ç¨‹åœ¨é‡‡æ ·æ—¶é—´æ®µå†…ç»ˆæ­¢äº†ï¼›å¦‚æœæ˜¯ç©ºï¼Œè¯´æ˜è¯¥è¿›ç¨‹æˆ–çº¿ç¨‹æ˜¯åœ¨å€’æ•°ç¬¬äºŒæ¬¡é‡‡æ ·æ—¶é—´ç‚¹ä¹‹å‰å·²ç»å­˜åœ¨ã€‚</p>
</div><div class="post-copyright"><script type="text/javascript" src="/blog/js/copyright.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/blog/css/copyright.css?v=1.0.0"><p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>ANRç¨‹åºé—®é¢˜åˆ†æä¹‹traces</p><p><span>æ–‡ç« ä½œè€…ï¼š</span>xmaihh</p><p><span>å‘å¸ƒæ—¶é—´ï¼š</span>2018-07-13</p><p><span>æœ€åæ›´æ–°ï¼š</span>2018-07-13</p><p><span>åŸå§‹é“¾æ¥ï¼š</span><a href="/2018/07/13/anr-cheng-xu-wen-ti-fen-xi-zhi-traces/">https://xmaihh.github.io/blog/2018/07/13/anr-cheng-xu-wen-ti-fen-xi-zhi-traces/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://xmaihh.github.io/blog/2018/07/13/anr-cheng-xu-wen-ti-fen-xi-zhi-traces/"></i></span></p><p><span>ç‰ˆæƒå£°æ˜ï¼š</span>é‡‡ç”¨<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">[CC BY-NC-SA 4.0è®¸å¯åè®®]</a>è¿›è¡Œè®¸å¯</p></div><br><script type="text/javascript" src="/blog/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://xmaihh.github.io/blog/2018/07/13/anr-cheng-xu-wen-ti-fen-xi-zhi-traces/" data-id="cm2e1ez2s0009f1q17y9b0bva" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACqElEQVR42u3by24bMRAEQP//TytAkEMAP9Q9Q8pOUHtaWCsuixfSPaO3t/h6/L5O3f99vX/msyffP3PswsPDwxtN/evhkhc84uvr5cuXNRofDw8P7xpvthlsNpj27ckc8PDw8H4ar53cbGvJR8PDw8P7d3k5pt1s8vACDw8P7/W8JIzIj8XtOLPY93DWgoeHh9flqC8tgO3vf3R9Dw8P77/mPUZXshkkf8mjh9ls8fDw8G7w8iPs7LC7DzLakZ9kLXh4eHiHeHmA2066bSNIDvH5CHh4eHg3eKde0La6biLXImLGw8PDu8Zry/Z5GSzZZtofAxSzxcPDw7vAO3sKnQW+bRix2mzw8PDw1ry2oDUrayVxcHuMjhpq8fDw8L6Jl4cRs0/b1LloTsXDw8N7OW92UD4bRqyiCjw8PLwLvP0mcWpCeQDx0j0QDw8Pb8SbtZO2yLZtKx8fDw8P7wYvOS7vmwZmy9oexD94Ix4eHt4FXl6Mv9HAuimn5d/Cw8PDO8ub/fMfFe/XTVezFgQ8PDy827xNW+r+qD1rLKizFjw8PLxDvDa6bc/pw9UteZ9+Cw8PD+8ab9ZKlU+xZecLHfWU4eHh4V3g5QHBqjdhFEbMGgj+fAsPDw/vGi8/Fs8Ou3nTVbtFPZkbHh4e3gXevri14eXbySzqxcPDw7vB2zRF5VPctG1tqHh4eHg3eO1DeWNTWxhrl6x9Ix4eHt4p3qO8Wszsvm1TeNLij4eHh3eUN2uB2jdd3VgsPDw8vFfyks1g9ummoNUuVl3lw8PDw1vz8rLWJrRNxtm0cA2rZ3h4eHiXeXn5Km943TcxPElc8PDw8L6JN9sk8uC1vY/Kcnh4eHjXeJty/izAbZuxhkEGHh4e3gXevgCWxwQ3DuWbVi08PDy8kvcLG+4r8P6GiZIAAAAASUVORK5CYII=">åˆ†äº«</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/ANR/" rel="tag">ANR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Android/" rel="tag">Android</a></li></ul></div><div class="post-nav"><a class="pre" href="/blog/2018/07/14/anr-cheng-xu-wen-ti-fen-xi-zhi-dropbox/">ANRç¨‹åºé—®é¢˜åˆ†æä¹‹dropbox</a><a class="next" href="/blog/2018/07/12/anr-cheng-xu-wu-xiang-ying-jian-jie/">ANRç¨‹åºæ— å“åº”ç®€ä»‹</a></div><div class="nofancybox" id="vcomment"></div><script src="https://unpkg.com/valine/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'false' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'WyoZPeMWzhLWRYAeA5ueZwiI-MdYXbMMI',
  appKey:'2n4nqRtMlbjNwRNodC3rPRQI',
  serverURLs:'https://wyozpemw.api.lncldglobal.com',
  placeholder:'Just so so',
  avatar:'robohash',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img class="nofancybox" src="/blog/img/avatar.svg"/></a><p>äº²è‡ªéƒ¨ç½² äº²è‡ªæŒ‡æŒ¥</p><a class="info-icon" href="https://github.com/xmaihh" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/blog/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">å­¦ä¹ ç¬”è®°</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/">æŠ€æœ¯åˆ†äº«</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/blog/tags/Android/" style="font-size: 15px;">Android</a> <a href="/blog/tags/ADB/" style="font-size: 15px;">ADB</a> <a href="/blog/tags/ANR/" style="font-size: 15px;">ANR</a> <a href="/blog/tags/BLE/" style="font-size: 15px;">BLE</a> <a href="/blog/tags/Lottie/" style="font-size: 15px;">Lottie</a> <a href="/blog/tags/OTA/" style="font-size: 15px;">OTA</a> <a href="/blog/tags/SDK/" style="font-size: 15px;">SDK</a> <a href="/blog/tags/Logcat/" style="font-size: 15px;">Logcat</a> <a href="/blog/tags/AndroidStudio/" style="font-size: 15px;">AndroidStudio</a> <a href="/blog/tags/Jni/" style="font-size: 15px;">Jni</a> <a href="/blog/tags/Serialport/" style="font-size: 15px;">Serialport</a> <a href="/blog/tags/Java/" style="font-size: 15px;">Java</a> <a href="/blog/tags/BT/" style="font-size: 15px;">BT</a> <a href="/blog/tags/RS232/" style="font-size: 15px;">RS232</a> <a href="/blog/tags/Archlinux/" style="font-size: 15px;">Archlinux</a> <a href="/blog/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/blog/tags/ArkUI/" style="font-size: 15px;">ArkUI</a> <a href="/blog/tags/Harmony/" style="font-size: 15px;">Harmony</a> <a href="/blog/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/blog/tags/Cloudflare/" style="font-size: 15px;">Cloudflare</a> <a href="/blog/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/blog/tags/docker-compose/" style="font-size: 15px;">docker-compose</a> <a href="/blog/tags/Debian/" style="font-size: 15px;">Debian</a> <a href="/blog/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a> <a href="/blog/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/blog/tags/Frp/" style="font-size: 15px;">Frp</a> <a href="/blog/tags/Github-Actions/" style="font-size: 15px;">Github Actions</a> <a href="/blog/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/blog/tags/CI-CD/" style="font-size: 15px;">CI/CD</a> <a href="/blog/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/blog/tags/Portainer/" style="font-size: 15px;">Portainer</a> <a href="/blog/tags/SQL/" style="font-size: 15px;">SQL</a> <a href="/blog/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/blog/tags/ArchLinux/" style="font-size: 15px;">ArchLinux</a> <a href="/blog/tags/Pixel8/" style="font-size: 15px;">Pixel8</a> <a href="/blog/tags/Magisk/" style="font-size: 15px;">Magisk</a> <a href="/blog/tags/Python/" style="font-size: 15px;">Python</a> <a href="/blog/tags/RecyclerView/" style="font-size: 15px;">RecyclerView</a> <a href="/blog/tags/Gdrive/" style="font-size: 15px;">Gdrive</a> <a href="/blog/tags/ZeroTier/" style="font-size: 15px;">ZeroTier</a> <a href="/blog/tags/Watchdog/" style="font-size: 15px;">Watchdog</a> <a href="/blog/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/blog/tags/Git/" style="font-size: 15px;">Git</a> <a href="/blog/tags/Github/" style="font-size: 15px;">Github</a> <a href="/blog/tags/Windows/" style="font-size: 15px;">Windows</a> <a href="/blog/tags/Proxy/" style="font-size: 15px;">Proxy</a> <a href="/blog/tags/Sqlite/" style="font-size: 15px;">Sqlite</a> <a href="/blog/tags/Kotlin/" style="font-size: 15px;">Kotlin</a> <a href="/blog/tags/Tailscale/" style="font-size: 15px;">Tailscale</a> <a href="/blog/tags/weixin/" style="font-size: 15px;">weixin</a> <a href="/blog/tags/Openwrt/" style="font-size: 15px;">Openwrt</a> <a href="/blog/tags/npm/" style="font-size: 15px;">npm</a> <a href="/blog/tags/macOS/" style="font-size: 15px;">macOS</a> <a href="/blog/tags/DoH/" style="font-size: 15px;">DoH</a> <a href="/blog/tags/Design-pattern/" style="font-size: 15px;">Design pattern</a> <a href="/blog/tags/Raspberry-Pi/" style="font-size: 15px;">Raspberry Pi</a> <a href="/blog/tags/VLC/" style="font-size: 15px;">VLC</a> <a href="/blog/tags/CRC/" style="font-size: 15px;">CRC</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2024/10/17/hexo-bo-ke-qi-yong-websub/">Hexoåšå®¢å¯ç”¨ WebSub</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/10/16/rang-follow-ren-zheng-wo-de-hexo-bo-ke-ding-yue-yuan/">è®©Followè®¤è¯æˆ‘çš„Hexoåšå®¢è®¢é˜…æº</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/09/10/portainer-chong-zhi-admin-deng-lu-mi-ma/">Portaineré‡ç½®adminç™»å½•å¯†ç </a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/08/02/hua-shuo-lu-you-qi-xiu-gai-hosts/">åç¡•è·¯ç”±å™¨ä¿®æ”¹Hosts</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/30/flutter-shi-yong-intl-generator-zai-windows-xia-bao-cuo-cannot-open-file-path-l10n-arb-intl-arb-os-error-wen-jian-ming-mu-lu-ming-huo-juan-biao-yu-fa-bu-zheng-que/">Flutterä½¿ç”¨intl_generatoråœ¨Windowsä¸‹æŠ¥é”™Cannot open file, path = 'l10n-arb/intl_*.arb' (OS Error: æ–‡ä»¶åã€ç›®å½•åæˆ–å·æ ‡è¯­æ³•ä¸æ­£ç¡®</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/26/zai-hexo-zhong-shi-yong-plantuml/">åœ¨Hexoä¸­ä½¿ç”¨PlantUML</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/26/yong-yu-gou-jian-he-fa-bu-flutter-ying-yong-cheng-xu-de-github-actions-gong-zuo-liu-cheng/">ç”¨äºæ„å»ºå’Œå‘å¸ƒ Flutter åº”ç”¨ç¨‹åºçš„GitHub Actions å·¥ä½œæµç¨‹</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/25/flutter-ge-ge-ping-tai-de-gou-jian-chan-wu/">Flutterå„ä¸ªå¹³å°çš„æ„å»ºäº§ç‰©</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/24/flutter-she-zhi-app-ban-ben/">Flutterè®¾ç½®Appç‰ˆæœ¬</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2024/07/15/windows-xia-jin-wei-github-she-zhi-ssh-dai-li/">Windowsä¸‹ä»…ä¸º GitHub è®¾ç½®SSHä»£ç†</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div><ul></ul><a href="https://quincyjiang.github.io/" title="ç˜Ÿç–«é’å¹´" target="_blank">ç˜Ÿç–«é’å¹´</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2024 <a href="/blog/." rel="nofollow">å°éº¦.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/blog/css/search.css?v=1.0.0"><script type="text/javascript" src="/blog/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/blog/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="100,99,98" opacity="0.7" zIndex="-1" count="150" src="https://unpkg.com/canvas-nest.js/dist/canvas-nest.js"></script><script type="text/javascript" src="/blog/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸï¼"></script><link rel="stylesheet" type="text/css" href="/blog/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=1.0.0"></script></div></body></html>